import{aI as Me,au as at,aV as Le,aW as Ee,r as b,j as e,am as me,aR as lt,m as te,aJ as ue,P as O,C as Fe,E as Se,aj as v,l as L,o as Ve,X as $,$ as R,Z as J,n as se,ap as rt,aX as nt,J as it,U as Ce,a7 as z,A as ze,Q as dt,az as ot,i as ct,z as xt,q as mt,V as ut,T as bt,aT as ht,aN as pt}from"./index-9msspAXs.js";import{I as Ue}from"./ItemMenu-VUnNMYsH.js";import{W as Z}from"./wallet-B-Jnzj-V.js";import{F as gt}from"./fuel-CJFsjG9T.js";import{L as K,G as Te,T as ft,C as $e,B as jt,a as Nt,W as kt}from"./wrench-Cb94Jej8.js";import{T as qe}from"./trending-up-kT6XmkFT.js";import{C as W}from"./circle-check-big-LAuxg_Ck.js";import{S as be}from"./save-Dy9vvheN.js";import{P as U}from"./plus-CMsmunyR.js";import{T as _e}from"./triangle-alert-2A0dCFLU.js";import{d as wt}from"./differenceInDays-DsnmgZM9.js";import{B as Ae}from"./bike-Dlxb_FhM.js";import{A as Ie}from"./archive-DkholNfQ.js";import{T as Be}from"./trending-down-CdZPREFM.js";import{D as Pe}from"./DeleteConfirmationModal-C3Ect0Gz.js";import{u as yt,S as vt}from"./useSelection-Lbc3MKXR.js";import{S as Dt}from"./shield-alert-DOWk1i5L.js";import{C as Mt}from"./chevron-down-TRwM3OYb.js";import{E as St}from"./ellipsis-CVoln8BK.js";import"./eye-BqTX6Mm8.js";import"./pen-DY3Fb26x.js";import"./square-check-big-dwW8C68g.js";import"./square-lZ11Ib2v.js";function Oe(l,s){const a=()=>at(s?.in,NaN),t=It(l);let d;if(t.date){const r=Pt(t.date,2);d=Ot(r.restDateString,r.year)}if(!d||isNaN(+d))return a();const c=+d;let i=0,m;if(t.time&&(i=Rt(t.time),isNaN(i)))return a();if(t.timezone){if(m=Lt(t.timezone),isNaN(m))return a()}else{const r=new Date(c+i),j=Me(0,s?.in);return j.setFullYear(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate()),j.setHours(r.getUTCHours(),r.getUTCMinutes(),r.getUTCSeconds(),r.getUTCMilliseconds()),j}return Me(c+i+m,s?.in)}const ee={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},Ct=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,Tt=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,At=/^([+-])(\d{2})(?::?(\d{2}))?$/;function It(l){const s={},a=l.split(ee.dateTimeDelimiter);let n;if(a.length>2)return s;if(/:/.test(a[0])?n=a[0]:(s.date=a[0],n=a[1],ee.timeZoneDelimiter.test(s.date)&&(s.date=l.split(ee.timeZoneDelimiter)[0],n=l.substr(s.date.length,l.length))),n){const t=ee.timezone.exec(n);t?(s.time=n.replace(t[1],""),s.timezone=t[1]):s.time=n}return s}function Pt(l,s){const a=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+s)+"})|(\\d{2}|[+-]\\d{"+(2+s)+"})$)"),n=l.match(a);if(!n)return{year:NaN,restDateString:""};const t=n[1]?parseInt(n[1]):null,d=n[2]?parseInt(n[2]):null;return{year:d===null?t:d*100,restDateString:l.slice((n[1]||n[2]).length)}}function Ot(l,s){if(s===null)return new Date(NaN);const a=l.match(Ct);if(!a)return new Date(NaN);const n=!!a[4],t=H(a[1]),d=H(a[2])-1,c=H(a[3]),i=H(a[4]),m=H(a[5])-1;if(n)return Ut(s,i,m)?Et(s,i,m):new Date(NaN);{const r=new Date(0);return!Vt(s,d,c)||!zt(s,t)?new Date(NaN):(r.setUTCFullYear(s,d,Math.max(t,c)),r)}}function H(l){return l?parseInt(l):1}function Rt(l){const s=l.match(Tt);if(!s)return NaN;const a=xe(s[1]),n=xe(s[2]),t=xe(s[3]);return $t(a,n,t)?a*Le+n*Ee+t*1e3:NaN}function xe(l){return l&&parseFloat(l.replace(",","."))||0}function Lt(l){if(l==="Z")return 0;const s=l.match(At);if(!s)return 0;const a=s[1]==="+"?-1:1,n=parseInt(s[2]),t=s[3]&&parseInt(s[3])||0;return qt(n,t)?a*(n*Le+t*Ee):NaN}function Et(l,s,a){const n=new Date(0);n.setUTCFullYear(l,0,4);const t=n.getUTCDay()||7,d=(s-1)*7+a+1-t;return n.setUTCDate(n.getUTCDate()+d),n}const Ft=[31,null,31,30,31,30,31,31,30,31,30,31];function We(l){return l%400===0||l%4===0&&l%100!==0}function Vt(l,s,a){return s>=0&&s<=11&&a>=1&&a<=(Ft[s]||(We(l)?29:28))}function zt(l,s){return s>=1&&s<=(We(l)?366:365)}function Ut(l,s,a){return s>=1&&s<=53&&a>=0&&a<=6}function $t(l,s,a){return l===24?s===0&&a===0:a>=0&&a<60&&s>=0&&s<60&&l>=0&&l<25}function qt(l,s){return s>=0&&s<=59}const _t=({activeVehicle:l,trendData:s,maxTrendCost:a,stats:n,combinedHistory:t,historyFilter:d,setHistoryFilter:c,onAddEntry:i,sortedVehicles:m,showArchived:r,getIcon:j,setVehicleActive:u,setDeleteConfirmId:f,toggleArchiveVehicle:x,isSelectionMode:k,selectedIds:p,toggleSelection:D,enterSelectionMode:N})=>{const w=b.useRef(null),S=h=>{w.current=setTimeout(()=>{N(h)},600)},T=()=>{w.current&&(clearTimeout(w.current),w.current=null)};return e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[n?.breakdown&&e.jsxs("section",{className:"mt-2 mb-2",children:[e.jsxs("h3",{className:"font-bold text-slate-900 dark:text-white px-1 mb-2 text-sm flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4 text-slate-400"}),"Cost Breakdown"]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:[{label:"Fuel",amount:n.breakdown.fuel,icon:gt,color:"text-orange-500",bg:"bg-orange-50 dark:bg-orange-900/20"},{label:"Service",amount:n.breakdown.service,icon:me,color:"text-blue-500",bg:"bg-blue-50 dark:bg-blue-900/20"},{label:"EMI",amount:n.breakdown.emi,icon:K,color:"text-indigo-500",bg:"bg-indigo-50 dark:bg-indigo-900/20"},{label:"Insure",amount:n.breakdown.insurance,icon:lt,color:"text-emerald-500",bg:"bg-emerald-50 dark:bg-emerald-900/20"}].map(h=>e.jsxs("div",{className:"bg-white dark:bg-slate-900 border border-slate-100 dark:border-slate-800 rounded-xl p-2 text-center shadow-sm flex flex-col items-center justify-between",children:[e.jsx("div",{className:`w-6 h-6 rounded-full ${h.bg} ${h.color} flex items-center justify-center mb-1`,children:e.jsx(h.icon,{className:"w-3 h-3"})}),e.jsx("p",{className:"text-[9px] font-bold text-slate-500 uppercase",children:h.label}),e.jsxs("p",{className:"text-xs font-bold text-slate-900 dark:text-white mt-0.5",children:["₹",h.amount>1e3?(h.amount/1e3).toFixed(1)+"k":h.amount]})]},h.label))})]}),s.length>0&&e.jsxs("section",{className:"mt-6 mb-2",children:[e.jsxs("h3",{className:"font-bold text-slate-900 dark:text-white px-1 mb-3 text-sm flex items-center gap-2",children:[e.jsx(qe,{className:"w-4 h-4 text-slate-400"}),"6-Month Trend"]}),e.jsx("div",{className:"bg-white dark:bg-slate-900 border border-slate-100 dark:border-slate-800 rounded-xl p-4 shadow-sm flex items-end justify-between h-32",children:s.map((h,A)=>e.jsxs("div",{className:"flex flex-col items-center gap-2 w-full group relative",children:[e.jsxs("span",{className:"absolute -top-6 text-[10px] font-bold text-indigo-600 dark:text-indigo-400 opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap",children:["₹",h.cost>1e3?(h.cost/1e3).toFixed(1)+"k":h.cost]}),e.jsx("div",{className:"w-full max-w-[24px] bg-slate-100 dark:bg-slate-800 rounded-t-lg relative flex flex-col justify-end h-16",children:e.jsx(te.div,{initial:{height:0},animate:{height:`${h.cost/a*100}%`},className:"bg-indigo-500 rounded-t-lg w-full transition-all group-hover:bg-indigo-400"})}),e.jsx("p",{className:"text-[9px] font-bold text-slate-400 uppercase",children:h.label})]},A))})]}),e.jsxs("section",{className:"mt-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("h3",{className:"font-bold text-slate-900 dark:text-white flex items-center gap-2 text-sm",children:[e.jsx(ue,{className:"w-4 h-4 text-slate-500"}),"Transactions"]})}),e.jsx("div",{className:"flex items-center gap-2 overflow-x-auto pb-1 hide-scrollbar mb-4",children:["All","Fuel","Service","EMI","Insurance"].map(h=>e.jsx(O,{onClick:()=>c(h),scaleDown:.92,className:`text-[10px] uppercase tracking-wider font-bold px-3 py-1.5 rounded-full whitespace-nowrap transition-colors ${d===h?"bg-slate-900 text-white dark:bg-white dark:text-slate-900":"bg-slate-100 text-slate-500 hover:bg-slate-200 dark:bg-slate-800 dark:text-slate-400 dark:hover:bg-slate-700"}`,children:h},h))}),e.jsx("div",{className:"space-y-3",children:t.length===0?e.jsxs("div",{className:"text-center py-8 bg-white dark:bg-slate-900 rounded-2xl border border-dashed border-slate-200 dark:border-slate-800",children:[e.jsx(Z,{className:"w-8 h-8 text-slate-300 mx-auto mb-2"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"No transaction records found."})]}):t.map((h,A)=>{const o=p.includes(h.id);return e.jsxs(O,{onClick:()=>k&&D(h.id),onMouseDown:()=>S(h.id),onMouseUp:T,onMouseLeave:T,onTouchStart:()=>S(h.id),onTouchEnd:T,scaleDown:.98,className:Se("bg-white dark:bg-slate-900 p-4 rounded-xl border transition-all flex items-start justify-between group cursor-pointer w-full text-left",o?"border-indigo-500 ring-1 ring-indigo-500 bg-indigo-50/10":"border-slate-100 dark:border-slate-800"),children:[e.jsxs("div",{className:"flex items-start gap-3",children:[k&&e.jsx("div",{className:Se("w-5 h-5 rounded-full border flex items-center justify-center mt-1 transition-colors",o?"bg-indigo-600 border-indigo-600":"border-slate-300 dark:border-slate-700"),children:o&&e.jsx(Fe,{className:"w-3 h-3 text-white"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h5",{className:"font-bold text-slate-900 dark:text-white text-sm capitalize",children:h.type}),h.financeTxId&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500",title:"Synced with Finance"})]}),e.jsx("p",{className:"text-xs text-slate-400",children:v(new Date(h.date),"MMM d, yyyy")}),h.notes&&e.jsx("p",{className:"text-xs text-slate-500 mt-2 line-clamp-2",children:h.notes})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:"text-right",children:[h.amount>0&&e.jsxs("span",{className:"block font-bold text-slate-900 dark:text-white text-sm",children:["₹",Number(h.amount).toLocaleString()]}),h.odometer&&e.jsxs("span",{className:"block text-[10px] text-slate-400 mt-1 bg-slate-100 dark:bg-slate-800 px-1.5 py-0.5 rounded-lg inline-block",children:[Number(h.odometer).toLocaleString()," km"]})]}),!k&&e.jsx(Ue,{onEdit:()=>alert("Edit item coming soon"),onDelete:()=>f(h.id)})]})]},h.id||A)})})]})]})},Bt=({isOpen:l,onClose:s,onComplete:a,followUp:n,vehicle:t})=>{L(l);const{accounts:d}=Ve(),[c,i]=b.useState({date:new Date().toISOString().split("T")[0],cost:"",odometer:t?.odometer||"",notes:"",accountId:(d||[]).find(u=>!u.isArchived)?.id||""});if(!l||!n)return null;const[m,r]=b.useState(!1),j=u=>{u.preventDefault(),a(n.id,{...c,cost:Number(c.cost)||0,odometer:Number(c.odometer)||t.odometer}),s()};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-2xl w-full max-w-md shadow-2xl border border-slate-100 dark:border-slate-800 animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"p-4 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center bg-indigo-50 dark:bg-indigo-900/10",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(W,{className:"w-5 h-5 text-emerald-500"}),"Complete Service"]}),e.jsx("p",{className:"text-xs text-slate-500 ml-7",children:n.name||n.type})]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-white/50 rounded-full transition-colors",children:e.jsx($,{className:"w-5 h-5 text-slate-500"})})]}),e.jsxs("form",{onSubmit:j,className:"p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Date Completed"}),e.jsxs("button",{type:"button",onClick:()=>r(!0),className:"w-full bg-slate-50 dark:bg-slate-800 border-none rounded-xl px-4 py-3 text-slate-900 dark:text-white text-left flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4 text-slate-400 shrink-0"}),c.date?v(new Date(c.date+"T00:00:00"),"MMM d, yyyy"):"Select date"]}),e.jsx(J,{isOpen:m,onClose:()=>r(!1),initialDate:c.date?new Date(c.date+"T00:00:00"):new Date,onSelect:u=>{i({...c,date:v(u,"yyyy-MM-dd")}),r(!1)}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"New Odometer"}),e.jsx("input",{type:"number",required:!0,placeholder:t.odometer,value:c.odometer,onChange:u=>i({...c,odometer:u.target.value}),className:"w-full bg-slate-50 dark:bg-slate-800 border-none rounded-xl px-4 py-3 text-slate-900 dark:text-white"})]})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800/50 p-4 rounded-xl border border-slate-100 dark:border-slate-800 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Z,{className:"w-4 h-4 text-slate-400"}),e.jsx("h3",{className:"text-sm font-bold text-slate-700 dark:text-slate-300",children:"Cost & Payment"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Total Cost (Optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-3 text-slate-400 font-bold",children:"₹"}),e.jsx("input",{type:"number",placeholder:"0",value:c.cost,onChange:u=>i({...c,cost:u.target.value}),className:"w-full bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-xl pl-8 pr-4 py-3 text-slate-900 dark:text-white focus:ring-2 focus:ring-indigo-500"})]})]}),Number(c.cost)>0&&e.jsxs("div",{className:"animate-in slide-in-from-top-2",children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Paid From"}),e.jsx("select",{value:c.accountId,onChange:u=>i({...c,accountId:u.target.value}),className:"w-full bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-xl px-4 py-3 text-slate-900 dark:text-white",children:d.filter(u=>!u.isArchived).map(u=>e.jsxs("option",{value:u.id,children:[u.name," (₹",u.balance,")"]},u.id))}),e.jsxs("p",{className:"text-[10px] text-indigo-500 mt-1 flex items-center gap-1",children:[e.jsx(W,{className:"w-3 h-3"})," Creates expense in Finance"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Notes (Optional)"}),e.jsx("textarea",{rows:"2",placeholder:"Details about service, parts changed...",value:c.notes,onChange:u=>i({...c,notes:u.target.value}),className:"w-full bg-slate-50 dark:bg-slate-800 border-none rounded-xl px-4 py-3 text-slate-900 dark:text-white text-sm"})]}),e.jsxs("button",{type:"submit",className:"w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 rounded-xl mt-2 transition-colors flex items-center justify-center gap-2",children:[e.jsx(W,{className:"w-5 h-5"}),"Complete & Log"]})]})]})})},Wt=["Refuel","Servicing","Oil Change","Tyre Change","Insurance Renewal","Pollution Check","Registration Renewal","Repair","Custom"],Yt=({isOpen:l,onClose:s,onSave:a,vehicle:n})=>{L(l);const[t,d]=b.useState({type:"Servicing",customType:"",triggerType:"date",date:"",odometer:"",isRecurring:!1,frequencyValue:3,frequencyUnit:"months",frequencyOdo:3e3});if(!l)return null;const[c,i]=b.useState(!1),m=r=>{if(r.preventDefault(),t.triggerType==="date"&&!t.date||t.triggerType==="odometer"&&!t.odometer)return;const j={name:t.type==="Custom"?t.customType:t.type,vehicleId:n.id,status:"pending",isRecurring:t.isRecurring};if(t.triggerType==="date"){if(j.interval_type="months",j.dueDate=t.date,t.isRecurring){let u=Number(t.frequencyValue);t.frequencyUnit==="years"?u=u*12:t.frequencyUnit==="days"&&(u=Math.max(1,Math.round(u/30))),j.interval_months=u}}else j.interval_type="km",j.dueOdometer=t.odometer,t.isRecurring&&(j.interval_km=Number(t.frequencyOdo));a(j),s()};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-2xl w-full max-w-md shadow-2xl border border-slate-100 dark:border-slate-800 animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"p-4 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-bold text-slate-900 dark:text-white",children:"Add Reminder"}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full transition-colors",children:e.jsx($,{className:"w-5 h-5 text-slate-500"})})]}),e.jsxs("form",{onSubmit:m,className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"Event Type"}),e.jsx("select",{value:t.type,onChange:r=>d({...t,type:r.target.value}),className:"w-full bg-slate-50 dark:bg-slate-800 border-none rounded-xl px-4 py-3 text-slate-900 dark:text-white",children:Wt.map(r=>e.jsx("option",{value:r,children:r},r))}),t.type==="Custom"&&e.jsx("input",{type:"text",placeholder:"Enter custom event name",value:t.customType,onChange:r=>d({...t,customType:r.target.value}),className:"mt-2 w-full bg-slate-50 dark:bg-slate-800 border-none rounded-xl px-4 py-3 text-slate-900 dark:text-white",required:!0})]}),e.jsxs("div",{className:"bg-slate-100 dark:bg-slate-800 p-1 rounded-xl flex",children:[e.jsx("button",{type:"button",onClick:()=>d({...t,triggerType:"date"}),className:`flex-1 py-2 rounded-lg text-sm font-bold transition-all ${t.triggerType==="date"?"bg-white dark:bg-slate-700 shadow-sm text-indigo-600 dark:text-indigo-400":"text-slate-500"}`,children:"Date Based"}),e.jsx("button",{type:"button",onClick:()=>d({...t,triggerType:"odometer"}),className:`flex-1 py-2 rounded-lg text-sm font-bold transition-all ${t.triggerType==="odometer"?"bg-white dark:bg-slate-700 shadow-sm text-indigo-600 dark:text-indigo-400":"text-slate-500"}`,children:"Odometer Based"})]}),t.triggerType==="date"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Due Date"}),e.jsxs("button",{type:"button",onClick:()=>i(!0),className:"w-full bg-slate-50 dark:bg-slate-800 border-none rounded-xl px-4 py-3 text-slate-900 dark:text-white text-left flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4 text-slate-400 shrink-0"}),t.date?v(new Date(t.date+"T00:00:00"),"MMM d, yyyy"):"Select date"]}),e.jsx(J,{isOpen:c,onClose:()=>i(!1),initialDate:t.date?new Date(t.date+"T00:00:00"):new Date,onSelect:r=>{d({...t,date:v(r,"yyyy-MM-dd")}),i(!1)},minDate:new Date})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-indigo-50 dark:bg-indigo-900/20 p-3 rounded-xl",children:[e.jsx("input",{type:"checkbox",id:"recurring_date",checked:t.isRecurring,onChange:r=>d({...t,isRecurring:r.target.checked}),className:"w-5 h-5 text-indigo-600 rounded focus:ring-indigo-500"}),e.jsx("label",{htmlFor:"recurring_date",className:"flex-1 text-sm font-medium text-indigo-900 dark:text-indigo-200",children:"Recurring Event"})]}),t.isRecurring&&e.jsxs("div",{className:"flex gap-2 items-center animate-in slide-in-from-top-2",children:[e.jsx("span",{className:"text-sm font-bold text-slate-500",children:"Every"}),e.jsx("input",{type:"number",value:t.frequencyValue,onChange:r=>d({...t,frequencyValue:r.target.value}),className:"w-20 bg-slate-50 dark:bg-slate-800 border-none rounded-xl px-3 py-2 text-center font-bold"}),e.jsxs("select",{value:t.frequencyUnit,onChange:r=>d({...t,frequencyUnit:r.target.value}),className:"flex-1 bg-slate-50 dark:bg-slate-800 border-none rounded-xl px-3 py-2 text-sm font-bold",children:[e.jsx("option",{value:"days",children:"Days"}),e.jsx("option",{value:"months",children:"Months"}),e.jsx("option",{value:"years",children:"Years"})]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Target Odometer (km)"}),e.jsxs("div",{className:"text-xs text-slate-400 mb-2",children:["Current: ",n.odometer," km"]}),e.jsx("input",{type:"number",required:!0,placeholder:Number(n.odometer)+3e3,value:t.odometer,onChange:r=>d({...t,odometer:r.target.value}),className:"w-full bg-slate-50 dark:bg-slate-800 border-none rounded-xl px-4 py-3 text-slate-900 dark:text-white"})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-indigo-50 dark:bg-indigo-900/20 p-3 rounded-xl",children:[e.jsx("input",{type:"checkbox",id:"recurring_odo",checked:t.isRecurring,onChange:r=>d({...t,isRecurring:r.target.checked}),className:"w-5 h-5 text-indigo-600 rounded focus:ring-indigo-500"}),e.jsx("label",{htmlFor:"recurring_odo",className:"flex-1 text-sm font-medium text-indigo-900 dark:text-indigo-200",children:"Recurring Event"})]}),t.isRecurring&&e.jsxs("div",{className:"flex gap-2 items-center animate-in slide-in-from-top-2",children:[e.jsx("span",{className:"text-sm font-bold text-slate-500",children:"Every"}),e.jsx("input",{type:"number",placeholder:"3000",value:t.frequencyOdo,onChange:r=>d({...t,frequencyOdo:r.target.value}),className:"flex-1 bg-slate-50 dark:bg-slate-800 border-none rounded-xl px-3 py-2 text-center font-bold"}),e.jsx("span",{className:"text-sm font-bold text-slate-500",children:"km"})]})]}),e.jsxs("button",{type:"submit",className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-xl mt-4 transition-colors flex items-center justify-center gap-2",children:[e.jsx(be,{className:"w-5 h-5"}),"Set Reminder"]})]})]})})},Ht=({vehicle:l})=>{const{followUps:s,completeFollowUp:a,deleteFollowUp:n,addFollowUp:t,getLatestRecord:d,toggleMaintenanceItem:c}=se(),[i,m]=b.useState(!1),[r,j]=b.useState(!1),[u,f]=b.useState(!1),[x,k]=b.useState(null);L(u);const p=s.filter(o=>o.vehicleId===l.id&&o.status!=="completed"),D=new Date,N=[],w=[],S=[];p.forEach(o=>{let y=!1,M=!1;if((o.interval_type==="months"||o.interval_type==="both"||o.frequencyType==="date"||o.frequencyType==="both")&&o.dueDate){const E=new Date(o.dueDate);rt(E,D)?y=!0:wt(E,D)<=14&&(M=!0)}if((o.interval_type==="km"||o.interval_type==="both"||o.frequencyType==="odometer"||o.frequencyType==="both")&&o.dueOdometer){const E=Number(l.odometer)||0,G=Number(o.dueOdometer);E>=G?y=!0:G-E<=500&&(M=!0)}const I={...o,isOverdue:y,isSoon:M};y?N.push(I):M?w.push(I):S.push(I)});const T=(o,y)=>o.dueDate&&y.dueDate?new Date(o.dueDate)-new Date(y.dueDate):0;N.sort(T),w.sort(T),S.sort(T);const h=o=>{k(o),m(!0)},A=(o,y)=>e.jsxs("div",{className:`bg-white dark:bg-slate-900 border rounded-xl p-3 mb-2 flex flex-col gap-2 shadow-sm ${y==="overdue"?"border-red-200 dark:border-red-900/50":y==="upcoming"?"border-orange-200 dark:border-orange-900/50":"border-slate-100 dark:border-slate-800"}`,children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`p-1.5 rounded-lg ${y==="overdue"?"bg-red-100 text-red-600":y==="upcoming"?"bg-orange-100 text-orange-600":"bg-slate-100 text-slate-500"}`,children:o.interval_type==="months"||o.frequencyType==="date"?e.jsx(R,{className:"w-4 h-4"}):e.jsx(Te,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-slate-900 dark:text-white text-sm",children:o.name||o.type}),e.jsxs("div",{className:`text-[10px] font-semibold flex flex-col ${y==="overdue"?"text-red-500":y==="upcoming"?"text-orange-500":"text-slate-400"}`,children:[(o.interval_type==="months"||o.interval_type==="both"||o.frequencyType==="date"||o.frequencyType==="both")&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(R,{className:"w-2.5 h-2.5"}),o.dueDate?`Due ${v(Oe(o.dueDate),"MMM d, yyyy")}`:"No date set"]}),(o.interval_type==="km"||o.interval_type==="both"||o.frequencyType==="odometer"||o.frequencyType==="both")&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Te,{className:"w-2.5 h-2.5"}),`Due at ${Number(o.dueOdometer).toLocaleString()} km`]})]})]})]}),o.isRecurring&&e.jsx("span",{className:"text-[10px] bg-indigo-50 text-indigo-600 px-1.5 py-0.5 rounded border border-indigo-100 dark:bg-indigo-900/30 dark:border-indigo-800 dark:text-indigo-300",children:"Recurring"})]}),e.jsxs("div",{className:"flex justify-between items-end mt-1",children:[e.jsx("div",{children:(()=>{const M=d(l.id,o.name||o.type);return M?e.jsxs("p",{className:"text-[9px] text-slate-400 font-medium",children:["Last: ",v(Oe(M.date),"MMM d, yyyy")," ",M.odometer?`(${Number(M.odometer).toLocaleString()} km)`:""]}):null})()}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>n(o.id),className:"text-xs text-slate-400 hover:text-red-500 px-2 py-1",children:"Dismiss"}),e.jsxs("button",{onClick:()=>h(o),className:"flex items-center gap-1 bg-emerald-50 text-emerald-600 hover:bg-emerald-100 border border-emerald-200 rounded-lg px-3 py-1.5 text-xs font-bold transition-colors dark:bg-emerald-900/20 dark:border-emerald-800 dark:text-emerald-400 dark:hover:bg-emerald-900/40",children:[e.jsx(W,{className:"w-3 h-3"})," Done"]})]})]})]},o.id);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white",children:"Reminders & Service"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>f(!0),className:"text-slate-600 text-[10px] font-bold bg-slate-100 hover:bg-slate-200 px-3 py-1.5 rounded-full flex items-center gap-1 transition-colors dark:bg-slate-800 dark:text-slate-400 dark:hover:bg-slate-700",children:[e.jsx(me,{className:"w-3 h-3"})," Manage"]}),e.jsxs("button",{onClick:()=>j(!0),className:"text-indigo-600 text-[10px] font-bold bg-indigo-50 hover:bg-indigo-100 px-3 py-1.5 rounded-full flex items-center gap-1 transition-colors dark:bg-indigo-900/30 dark:text-indigo-400 dark:hover:bg-indigo-900/50",children:[e.jsx(U,{className:"w-3 h-3"})," Add"]})]})]}),u&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-3xl w-full max-w-sm max-h-[80vh] overflow-hidden flex flex-col shadow-2xl animate-in zoom-in duration-200",children:[e.jsxs("div",{className:"p-6 border-b border-slate-100 dark:border-slate-800",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Standard Maintenance"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Select items to track for your vehicle."})]}),e.jsx("div",{className:"p-4 overflow-y-auto space-y-2",children:nt.filter(o=>!o.applicable||o.applicable.includes(l.type)).map(o=>{const y=s.some(M=>M.vehicleId===l.id&&(M.name===o.name||M.type===o.name)&&M.status!=="completed");return e.jsxs("button",{onClick:()=>c(l.id,o),className:`w-full p-4 rounded-2xl flex items-center justify-between transition-all border ${y?"bg-indigo-50 border-indigo-200 dark:bg-indigo-900/20 dark:border-indigo-800":"bg-slate-50 border-slate-100 dark:bg-slate-800 dark:border-slate-700 opacity-60"}`,children:[e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:`font-bold text-sm ${y?"text-indigo-900 dark:text-indigo-100":"text-slate-600 dark:text-slate-400"}`,children:o.name}),e.jsx("p",{className:"text-[10px] text-slate-500",children:o.interval_type==="both"?`Every ${o.interval_months} months / ${o.interval_km}km`:o.interval_type==="months"?`Every ${o.interval_months} months`:o.interval_type==="km"?`Every ${o.interval_km}km`:"Ad-hoc"})]}),e.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center transition-colors ${y?"bg-indigo-600 border-indigo-600":"border-slate-300 dark:border-slate-600"}`,children:y&&e.jsx(W,{className:"w-3 h-3 text-white"})})]},o.name)})}),e.jsx("div",{className:"p-4 bg-slate-50 dark:bg-slate-800/50",children:e.jsx("button",{onClick:()=>f(!1),className:"w-full bg-slate-900 text-white dark:bg-indigo-600 font-bold py-3 rounded-2xl",children:"Done"})})]})}),p.length===0&&e.jsxs("div",{className:"text-center py-6 bg-slate-50 dark:bg-slate-800/50 rounded-xl border border-dashed border-slate-200 dark:border-slate-800",children:[e.jsx(it,{className:"w-8 h-8 text-slate-300 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"No active reminders."}),e.jsx("button",{onClick:()=>j(!0),className:"text-indigo-500 text-xs font-bold mt-1",children:"Set one up"})]}),N.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-xs font-bold text-red-500 uppercase tracking-wider mb-2 flex items-center gap-1",children:[e.jsx(_e,{className:"w-3 h-3"})," Overdue"]}),N.map(o=>A(o,"overdue"))]}),w.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-bold text-orange-500 uppercase tracking-wider mb-2",children:"Due Soon"}),w.map(o=>A(o,"upcoming"))]}),S.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-2",children:"Upcoming"}),S.map(o=>A(o,"later"))]}),e.jsx(Bt,{isOpen:i,onClose:()=>m(!1),followUp:x,vehicle:l,onComplete:a}),e.jsx(Yt,{isOpen:r,onClose:()=>j(!1),vehicle:l,onSave:t})]})},Zt=({activeVehicle:l,nextService:s,activeTab:a,setEditingVehicle:n,setIsAddOpen:t})=>{const{getVehicleStats:d,serviceRecords:c}=se(),i=l?d(l.id):null;return e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-4 duration-500",children:[s&&e.jsxs("section",{className:"mt-2 mb-2",children:[e.jsxs("h3",{className:"font-bold text-slate-900 dark:text-white px-1 mb-2 text-sm flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4 text-slate-400"}),"Next Service Due"]}),e.jsxs("div",{className:"bg-indigo-50 dark:bg-indigo-900/20 p-4 rounded-xl border border-indigo-100 dark:border-indigo-800 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-indigo-100 dark:bg-indigo-800 text-indigo-600 dark:text-indigo-200 rounded-lg",children:e.jsx(me,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-indigo-900 dark:text-indigo-100 text-sm",children:s.type}),e.jsxs("p",{className:"text-[10px] text-indigo-700 dark:text-indigo-300 mt-0.5 max-w-[180px] break-words",children:[s.dueDate&&`Due: ${v(new Date(s.dueDate),"MMM d, yyyy")} `,s.dueDate&&s.dueOdometer&&"| ",s.dueOdometer&&`At ${Number(s.dueOdometer).toLocaleString()} km`]})]})]}),e.jsxs("div",{className:"text-right flex flex-col items-end gap-2",children:[s.dueDate&&e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-indigo-900 dark:text-indigo-100 leading-none",children:Math.max(0,Math.ceil((new Date(s.dueDate)-new Date)/(1e3*60*60*24)))}),e.jsx("p",{className:"text-[9px] text-indigo-600 dark:text-indigo-400 uppercase font-bold tracking-wider",children:"Days"})]}),s.dueOdometer&&e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-indigo-900 dark:text-indigo-100 leading-none",children:Math.max(0,Number(s.dueOdometer)-Number(l?.odometer||0)).toLocaleString()}),e.jsx("p",{className:"text-[9px] text-indigo-600 dark:text-indigo-400 uppercase font-bold tracking-wider",children:"km left"})]})]})]})]}),e.jsx(Ht,{vehicle:l}),i?.lastServiceDate&&e.jsxs("div",{className:"bg-emerald-50 dark:bg-emerald-900/20 p-4 rounded-xl flex items-start gap-3 border border-emerald-100 dark:border-emerald-800",children:[e.jsx("div",{className:"bg-emerald-100 dark:bg-emerald-800 p-2 rounded-full",children:e.jsx(ue,{className:"w-4 h-4 text-emerald-600 dark:text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-emerald-900 dark:text-emerald-100 text-sm",children:"Last Service"}),e.jsxs("p",{className:"text-xs text-emerald-700 dark:text-emerald-300 mt-1",children:[i.lastServiceType," on ",v(new Date(i.lastServiceDate),"MMM d, yyyy")]})]})]})]})},Kt=({activeLoan:l,activeVehicle:s,loanDetail:a,setIsAmortizationOpen:n,setIsPrepaymentOpen:t,setIsPayEMIOpen:d,setIsAddLoanOpen:c})=>l?e.jsxs("div",{className:"space-y-4 animate-in fade-in slide-in-from-right-4 duration-300 mt-2",children:[a?.status==="overdue"&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 p-4 rounded-xl flex items-start gap-3 animate-pulse",children:[e.jsx("div",{className:"p-2 bg-red-100 dark:bg-red-800 rounded-full text-red-600 dark:text-red-200",children:e.jsx(_e,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-red-900 dark:text-red-100 text-sm",children:"EMI Overdue"}),e.jsxs("p",{className:"text-xs text-red-700 dark:text-red-300 mt-1",children:["Payment is overdue by ",a.daysLate," days. Due date was ",v(new Date(a.dueDate),"MMM d, yyyy"),"."]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-6 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-800",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-slate-400 font-bold uppercase tracking-wider mb-1",children:"Total Loan Principal"}),e.jsxs("h4",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:["₹",l.totalLoanAmount.toLocaleString()]}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:l.lender})]}),e.jsx("div",{className:"bg-indigo-50 dark:bg-indigo-900/20 p-3 rounded-2xl",children:e.jsx(K,{className:"w-6 h-6 text-indigo-600 dark:text-indigo-400"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-xs font-bold mb-2",children:[e.jsx("span",{className:"text-slate-500",children:"Repayment Progress"}),e.jsxs("span",{className:"text-indigo-600 dark:text-indigo-400",children:["₹",(a?.totalPaid||0).toLocaleString()," Paid"]})]}),e.jsx("div",{className:"h-3 bg-slate-100 dark:bg-slate-800 rounded-full overflow-hidden",children:e.jsx(te.div,{initial:{width:0},animate:{width:`${(a?.totalPaid||0)/(a?.totalPayable||l.totalPayable||1)*100}%`},className:"h-full bg-gradient-to-r from-indigo-500 to-indigo-600"})}),e.jsxs("div",{className:"flex justify-between text-[10px] font-bold text-slate-400 mt-2 uppercase tracking-wide",children:[e.jsxs("span",{children:["Total Payable: ₹",(a?.totalPayable||l.totalPayable||0).toLocaleString()]}),e.jsxs("span",{children:["Balance: ₹",(a?.remainingBalance||0).toLocaleString()]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 py-4 border-y border-slate-50 dark:border-slate-800",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-slate-400 font-bold uppercase tracking-wider mb-1",children:"Tenure & Date"}),e.jsxs("p",{className:"font-bold text-sm",children:[l.tenureMonths," mo • ",l.startDate?v(new Date(l.startDate),"MMM yyyy"):"N/A"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-slate-400 font-bold uppercase tracking-wider mb-1",children:"Total Payable & Int"}),e.jsxs("p",{className:"font-bold text-sm",children:["₹",(l.totalPayable||0).toLocaleString()," ",e.jsxs("span",{className:"text-slate-400 text-xs font-normal",children:[" / ₹",(l.totalInterest||0).toLocaleString()," int"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 py-2",children:[e.jsxs("button",{onClick:()=>n(!0),className:"bg-indigo-50 dark:bg-indigo-900/20 text-indigo-600 dark:text-indigo-400 border border-indigo-100 dark:border-indigo-800 px-4 py-2.5 rounded-xl font-bold flex items-center justify-center gap-2 text-xs hover:bg-indigo-100 transition-colors",children:[e.jsx(qe,{className:"w-3.5 h-3.5"})," Amortization"]}),e.jsxs("button",{onClick:()=>t(!0),className:"bg-emerald-50 dark:bg-emerald-900/20 text-emerald-600 dark:text-emerald-400 border border-emerald-100 dark:border-emerald-800 px-4 py-2.5 rounded-xl font-bold flex items-center justify-center gap-2 text-xs hover:bg-emerald-100 transition-colors",children:[e.jsx(Z,{className:"w-3.5 h-3.5"})," Prepayment"]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-slate-400 font-bold uppercase tracking-wider mb-1",children:"Monthly EMI"}),e.jsxs("p",{className:"text-lg font-bold text-slate-900 dark:text-white",children:["₹",(a?.emi||l.emiAmount).toLocaleString()]})]}),e.jsx("button",{onClick:()=>d(!0),className:"bg-slate-900 dark:bg-white text-white dark:text-slate-900 px-6 py-3 rounded-2xl font-bold shadow-lg flex items-center gap-2 hover:scale-[1.02] transition-transform",children:"Record EMI"})]})]})]}),l.history.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-slate-900 dark:text-white mb-3 pl-2 flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4 text-slate-400"}),"Recent Payments"]}),e.jsx("div",{className:"space-y-3",children:l.history.slice().reverse().map(i=>e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-4 rounded-2xl border border-slate-100 dark:border-slate-800 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${i.type==="Penalty"?"bg-red-50 text-red-600":"bg-emerald-50 text-emerald-600"}`,children:e.jsx(Z,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-sm text-slate-900 dark:text-white",children:[i.type," Payment"]}),e.jsx("p",{className:"text-[10px] text-slate-400 uppercase font-bold",children:v(new Date(i.date),"MMM d, yyyy")})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold text-slate-900 dark:text-white text-sm",children:["₹",i.amount.toLocaleString()]}),e.jsxs("p",{className:"text-[9px] text-slate-400",children:["P: ₹",i.principal.toLocaleString()," | I: ₹",i.interest.toLocaleString()]})]})]},i.id))})]})]}):e.jsxs("div",{className:"text-center py-12 bg-white dark:bg-slate-900 rounded-3xl border border-dashed border-slate-200 dark:border-slate-800 px-6 mt-4",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-50 dark:bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(K,{className:"w-8 h-8 text-slate-300"})}),e.jsx("h4",{className:"text-lg font-bold text-slate-900 dark:text-white mb-2",children:"No Finance Records"}),e.jsx("p",{className:"text-slate-500 text-sm mb-8 max-w-xs mx-auto",children:"Keep track of your vehicle loans, EMIs, and interest payments in one place."}),e.jsxs("button",{onClick:()=>c(!0),className:"bg-slate-900 dark:bg-indigo-600 text-white px-8 py-3 rounded-2xl font-bold shadow-xl flex items-center gap-2 mx-auto hover:scale-105 transition-transform",children:[e.jsx(U,{className:"w-4 h-4"})," Initialize Finance"]})]}),Jt=[{id:"car",label:"Car",icon:z},{id:"bike",label:"Bike",icon:Ae},{id:"scooter",label:"Scooter",icon:Ae},{id:"commercial",label:"Commercial",icon:ft}],Gt=["Petrol","Diesel","Electric","Hybrid","CNG"],Re=({isOpen:l,onClose:s,onSave:a,editVehicle:n=null})=>{L(l);const[t,d]=b.useState({name:"",type:"car",brandModel:"",regNumber:"",purchaseDate:new Date().toISOString().split("T")[0],fuelType:"Petrol",odometer:""});b.useEffect(()=>{d(n?{name:n.name,type:n.type,brandModel:n.brandModel,regNumber:n.regNumber||"",purchaseDate:n.purchaseDate,fuelType:n.fuelType,odometer:n.odometer}:{name:"",type:"car",brandModel:"",regNumber:"",purchaseDate:new Date().toISOString().split("T")[0],fuelType:"Petrol",odometer:""})},[n,l]);const c=r=>{r.preventDefault(),a(t),s()},[i,m]=b.useState(!1);return l?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-2xl w-full max-w-md shadow-2xl border border-slate-100 dark:border-slate-800 overflow-hidden animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"p-4 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-bold text-slate-900 dark:text-white",children:n?"Edit Vehicle":"Add New Vehicle"}),e.jsx(Ce,{variant:"exit",onClick:s,size:"sm"})]}),e.jsxs("form",{onSubmit:c,className:"p-4 space-y-4",children:[e.jsx("div",{className:"grid grid-cols-4 gap-2",children:Jt.map(r=>{const j=r.icon,u=t.type===r.id;return e.jsxs("button",{type:"button",onClick:()=>d({...t,type:r.id}),className:`flex flex-col items-center justify-center p-2 rounded-xl border transition-all ${u?"bg-indigo-50 border-indigo-500 text-indigo-700 dark:bg-indigo-900/20 dark:border-indigo-500 dark:text-indigo-400":"bg-slate-50 border-slate-200 text-slate-500 hover:bg-slate-100 dark:bg-slate-800 dark:border-slate-700 dark:text-slate-400"}`,children:[e.jsx(j,{className:"w-6 h-6 mb-1"}),e.jsx("span",{className:"text-[10px] font-bold",children:r.label})]},r.id)})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Vehicle Name (Nickname)"}),e.jsx("input",{type:"text",required:!0,placeholder:"e.g. My Red Racer",value:t.name,onChange:r=>d({...t,name:r.target.value}),className:"w-full bg-slate-50 dark:bg-slate-800 border-none rounded-xl px-4 py-3 text-slate-900 dark:text-white focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Brand & Model"}),e.jsx("input",{type:"text",required:!0,placeholder:"e.g. Honda City 2022",value:t.brandModel,onChange:r=>d({...t,brandModel:r.target.value}),className:"w-full bg-slate-50 dark:bg-slate-800 border-none rounded-xl px-4 py-3 text-slate-900 dark:text-white focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Reg. Number (Optional)"}),e.jsx("input",{type:"text",placeholder:"KL-01-AB-1234",value:t.regNumber,onChange:r=>d({...t,regNumber:r.target.value}),className:"w-full bg-slate-50 dark:bg-slate-800 border-none rounded-xl px-4 py-3 text-slate-900 dark:text-white focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Fuel Type"}),e.jsx("select",{value:t.fuelType,onChange:r=>d({...t,fuelType:r.target.value}),className:"w-full bg-slate-50 dark:bg-slate-800 border-none rounded-xl px-4 py-3 text-slate-900 dark:text-white focus:ring-2 focus:ring-indigo-500",children:Gt.map(r=>e.jsx("option",{value:r,children:r},r))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Purchase Date"}),e.jsxs("button",{type:"button",onClick:()=>m(!0),className:"w-full bg-slate-50 dark:bg-slate-800 border-none rounded-xl px-4 py-3 text-slate-900 dark:text-white focus:ring-2 focus:ring-indigo-500 text-left flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4 text-slate-400 shrink-0"}),t.purchaseDate?v(new Date(t.purchaseDate+"T00:00:00"),"MMM d, yyyy"):"Select date"]}),e.jsx(J,{isOpen:i,onClose:()=>m(!1),initialDate:t.purchaseDate?new Date(t.purchaseDate+"T00:00:00"):new Date,onSelect:r=>{d({...t,purchaseDate:v(r,"yyyy-MM-dd")}),m(!1)}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Odometer (km)"}),e.jsx("input",{type:"number",required:!0,placeholder:"0",value:t.odometer,onChange:r=>d({...t,odometer:r.target.value}),className:"w-full bg-slate-50 dark:bg-slate-800 border-none rounded-xl px-4 py-3 text-slate-900 dark:text-white focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsx(Ce,{variant:"save",fullWidth:!0,onClick:c,label:n?"Update Vehicle":"Add Vehicle",iconOnly:!1,className:"mt-4 py-4"})]})]})}):null},Xt=({isOpen:l,onClose:s,setEditingVehicle:a,setIsAddOpen:n,setDeleteConfirmId:t})=>{const{vehicles:d,setVehicleActive:c,toggleArchiveVehicle:i}=se(),[m,r]=b.useState(!1);if(!l)return null;const u=[...d].sort((f,x)=>f.isActive?-1:x.isActive?1:0);return e.jsx(ze,{children:e.jsx("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-slate-900/50 backdrop-blur-sm p-4",children:e.jsxs(te.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"bg-white dark:bg-slate-900 w-full max-w-md rounded-3xl overflow-hidden shadow-2xl border border-slate-100 dark:border-slate-800 flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"p-4 border-b border-slate-100 dark:border-slate-800 flex items-center justify-between sticky top-0 bg-white/80 dark:bg-slate-900/80 backdrop-blur-md z-10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-indigo-50 dark:bg-indigo-900/30 rounded-xl",children:e.jsx(z,{className:"w-5 h-5 text-indigo-600 dark:text-indigo-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white",children:"Manage Vehicles"}),e.jsxs("p",{className:"text-[10px] text-slate-500",children:[d.length," Vehicles in Fleet"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>r(!m),className:`p-2 rounded-xl transition-colors ${m?"bg-indigo-100 text-indigo-700":"bg-slate-50 text-slate-400 hover:bg-slate-100 dark:bg-slate-800 dark:text-slate-500"}`,children:e.jsx(Ie,{className:"w-4 h-4"})}),e.jsx("button",{onClick:s,className:"p-2 bg-slate-50 dark:bg-slate-800 rounded-xl text-slate-400 hover:text-slate-600 dark:hover:text-white transition-colors",children:e.jsx($,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"overflow-y-auto p-4 space-y-3 flex-1",children:u.filter(f=>m?!0:!f.isActive).map(f=>e.jsxs("div",{className:`bg-white dark:bg-slate-900 p-4 rounded-2xl border ${f.isActive?"border-indigo-500 ring-1 ring-indigo-500":"border-slate-100 dark:border-slate-800"} shadow-sm relative overflow-hidden`,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${f.isActive?"bg-indigo-100 text-indigo-600":"bg-slate-100 text-slate-500 dark:bg-slate-800 dark:text-slate-400"}`,children:e.jsx(z,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 cursor-pointer",onClick:()=>{m||(c(f.id),s())},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-bold text-slate-900 dark:text-white text-sm",children:f.name}),f.isActive&&e.jsx(W,{className:"w-4 h-4 text-indigo-500"})]}),e.jsx("p",{className:"text-xs text-slate-500",children:f.brandModel})]})]}),e.jsx("div",{className:"mt-4 pt-3 border-t border-slate-50 dark:border-slate-800 flex justify-end",children:e.jsx(Ue,{onEdit:()=>{a(f),n(!0),s()},onDelete:()=>{t(f.id),s()},extraActions:[{label:f.isArchived?"Unarchive":"Archive",icon:Ie,onClick:()=>i(f.id)}]})})]},f.id))}),e.jsx("div",{className:"p-4 border-t border-slate-100 dark:border-slate-800 bg-slate-50 dark:bg-slate-900/50",children:e.jsxs("button",{onClick:()=>{a(null),n(!0),s()},className:"w-full bg-indigo-600 text-white p-3 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-indigo-700 transition-colors",children:[e.jsx(U,{className:"w-5 h-5"})," Add New Vehicle"]})})]})})})},Qt=({isOpen:l,onClose:s,onSave:a,vehicle:n})=>{L(l);const[t,d]=b.useState({vehicleId:n?.id||"",lender:"",totalLoanAmount:"",interestRate:"",interestType:"reducing",tenureMonths:"",startDate:new Date().toISOString().split("T")[0],dueDateDay:5}),[c,i]=b.useState(0),[m,r]=b.useState(0),[j,u]=b.useState(0);b.useEffect(()=>{n&&d(p=>({...p,vehicleId:n.id}))},[n]),b.useEffect(()=>{const p=Number(t.totalLoanAmount),D=Number(t.interestRate)/12/100,N=Number(t.tenureMonths);if(p>0&&D>0&&N>0)if(t.interestType==="reducing"){const w=p*D*Math.pow(1+D,N)/(Math.pow(1+D,N)-1),S=Math.round(w);i(S),r(S*N),u(S*N-p)}else{const w=p*(Number(t.interestRate)/100)*(N/12),S=(p+w)/N,T=Math.round(S);i(T),r(Math.round(p+w)),u(Math.round(w))}else i(0),r(0),u(0)},[t.totalLoanAmount,t.interestRate,t.tenureMonths,t.interestType]);const f=p=>{p.preventDefault(),a({...t,principal:Number(t.totalLoanAmount),interest_rate:Number(t.interestRate),tenure_months:Number(t.tenureMonths),start_date:t.startDate,emiAmount:c,totalPayable:m,totalInterest:j,totalLoanAmount:Number(t.totalLoanAmount),interestRate:Number(t.interestRate),tenureMonths:Number(t.tenureMonths),dueDateDay:Number(t.dueDateDay)}),s()};if(!l)return null;const[x,k]=b.useState(!1);return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-2xl w-full max-w-md shadow-2xl border border-slate-100 dark:border-slate-800 overflow-hidden animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"p-4 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center bg-slate-900 text-white",children:[e.jsxs("h2",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5 text-indigo-400"}),"Vehicle Financing"]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-white/10 rounded-full transition-colors",children:e.jsx($,{className:"w-5 h-5 text-slate-400"})})]}),e.jsxs("form",{onSubmit:f,className:"p-4 space-y-4 max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Lender / Bank Name"}),e.jsx("input",{type:"text",required:!0,placeholder:"e.g. HDFC Bank, SBI",value:t.lender,onChange:p=>d({...t,lender:p.target.value}),className:"w-full bg-slate-50 dark:bg-slate-800 border-none rounded-xl px-4 py-3 text-slate-900 dark:text-white focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Loan Amount (Principal)"}),e.jsx("input",{type:"number",required:!0,placeholder:"0",value:t.totalLoanAmount,onChange:p=>d({...t,totalLoanAmount:p.target.value}),className:"w-full bg-slate-50 dark:bg-slate-800 border-none rounded-xl px-4 py-3 text-slate-900 dark:text-white focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Interest Rate (% p.a.)"}),e.jsx("input",{type:"number",step:"0.01",required:!0,placeholder:"8.5",value:t.interestRate,onChange:p=>d({...t,interestRate:p.target.value}),className:"w-full bg-slate-50 dark:bg-slate-800 border-none rounded-xl px-4 py-3 text-slate-900 dark:text-white focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Tenure (Months)"}),e.jsx("input",{type:"number",required:!0,placeholder:"60",value:t.tenureMonths,onChange:p=>d({...t,tenureMonths:p.target.value}),className:"w-full bg-slate-50 dark:bg-slate-800 border-none rounded-xl px-4 py-3 text-slate-900 dark:text-white focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Interest Type"}),e.jsxs("select",{value:t.interestType,onChange:p=>d({...t,interestType:p.target.value}),className:"w-full bg-slate-50 dark:bg-slate-800 border-none rounded-xl px-4 py-3 text-slate-900 dark:text-white focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"reducing",children:"Reducing Balance"}),e.jsx("option",{value:"flat",children:"Flat Interest"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Start Date"}),e.jsxs("button",{type:"button",onClick:()=>k(!0),className:"w-full bg-slate-50 dark:bg-slate-800 border-none rounded-xl px-4 py-3 text-slate-900 dark:text-white focus:ring-2 focus:ring-indigo-500 text-left flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4 text-slate-400 shrink-0"}),t.startDate?v(new Date(t.startDate+"T00:00:00"),"MMM d, yyyy"):"Select date"]}),e.jsx(J,{isOpen:x,onClose:()=>k(!1),initialDate:t.startDate?new Date(t.startDate+"T00:00:00"):new Date,onSelect:p=>{d({...t,startDate:v(p,"yyyy-MM-dd")}),k(!1)}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"EMI Due Day"}),e.jsx("input",{type:"number",min:"1",max:"31",required:!0,placeholder:"5",value:t.dueDateDay,onChange:p=>d({...t,dueDateDay:p.target.value}),className:"w-full bg-slate-50 dark:bg-slate-800 border-none rounded-xl px-4 py-3 text-slate-900 dark:text-white focus:ring-2 focus:ring-indigo-500"})]})]}),c>0&&e.jsx("div",{className:"bg-indigo-50 dark:bg-indigo-900/20 p-4 rounded-2xl border border-indigo-100 dark:border-indigo-800 flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($e,{className:"w-5 h-5 text-indigo-600 dark:text-indigo-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-bold text-indigo-600 dark:text-indigo-400 uppercase",children:"Estimated Monthly EMI"}),e.jsxs("p",{className:"text-xl font-bold text-slate-900 dark:text-white",children:["₹",c.toLocaleString()]})]})]})}),e.jsxs("button",{type:"submit",className:"w-full bg-slate-900 hover:bg-slate-800 text-white font-bold py-4 rounded-xl mt-4 transition-colors flex items-center justify-center gap-2",children:[e.jsx(be,{className:"w-5 h-5"}),"Initialize Loan"]})]})]})})},es=({isOpen:l,onClose:s,onSave:a,loan:n,vehicle:t,loanDetail:d})=>{L(l);const{accounts:c}=Ve(),[i,m]=b.useState({type:"EMI",amount:"",date:new Date().toISOString().split("T")[0],accountId:(c||[]).find(x=>!x.isArchived)?.id||"",notes:"",principal:"",interest:"",penalty:0,discount:0});b.useEffect(()=>{if(n&&i.type==="EMI"){const x=Number(n.emiAmount);let k=0;d?.isPastDue&&(k=Math.round(x*.02*(d.daysLate/30)),k<100&&d.daysLate>0&&(k=500)),m(p=>({...p,amount:x,penalty:k}))}},[n,i.type,d]);const r=x=>{x.preventDefault(),a(n.id,{...i,amount:Number(i.amount),principal:Number(i.principal)||(i.type==="EMI"?Number(i.amount)*.7:Number(i.amount)),interest:Number(i.interest)||(i.type==="EMI"?Number(i.amount)*.3:0),penalty:Number(i.penalty),discount:Number(i.discount)}),s()};if(!l||!n)return null;const j=Number(n.remainingPrincipal),[u,f]=b.useState(!1);return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-2xl w-full max-w-md shadow-2xl border border-slate-100 dark:border-slate-800 overflow-hidden animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"p-4 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center bg-emerald-600 text-white",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(jt,{className:"w-5 h-5"}),"Record Payment"]}),e.jsxs("p",{className:"text-[10px] opacity-80",children:[n.lender," - ",t?.name]})]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-white/10 rounded-full transition-colors",children:e.jsx($,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:r,className:"p-4 space-y-4",children:[e.jsx("div",{className:"flex bg-slate-100 dark:bg-slate-800 p-1 rounded-xl",children:["EMI","Prepayment","Penalty"].map(x=>e.jsx("button",{type:"button",onClick:()=>m({...i,type:x}),className:`flex-1 py-2 text-xs font-bold rounded-lg transition-all ${i.type===x?"bg-white dark:bg-slate-700 shadow-sm text-emerald-600 dark:text-emerald-400":"text-slate-500"}`,children:x},x))}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Date"}),e.jsxs("button",{type:"button",onClick:()=>f(!0),className:"w-full bg-slate-50 dark:bg-slate-800 border-none rounded-xl px-4 py-3 text-slate-900 dark:text-white text-left flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4 text-slate-400 shrink-0"}),i.date?v(new Date(i.date+"T00:00:00"),"MMM d, yyyy"):"Select date"]}),e.jsx(J,{isOpen:u,onClose:()=>f(!1),initialDate:i.date?new Date(i.date+"T00:00:00"):new Date,onSelect:x=>{m({...i,date:v(x,"yyyy-MM-dd")}),f(!1)}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Total Paid Amount"}),e.jsx("input",{type:"number",required:!0,placeholder:"0",value:i.amount,onChange:x=>m({...i,amount:x.target.value}),className:"w-full bg-slate-50 dark:bg-slate-800 border-none rounded-xl px-4 py-3 text-slate-900 dark:text-white font-bold"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-bold text-red-400 uppercase tracking-wider mb-1 flex items-center gap-1",children:[e.jsx(dt,{className:"w-3 h-3"})," Penalty Paid"]}),e.jsx("input",{type:"number",value:i.penalty,onChange:x=>m({...i,penalty:x.target.value}),className:"w-full bg-red-50 dark:bg-red-900/10 border-none rounded-xl px-4 py-3 text-red-600 dark:text-red-400 font-bold"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-bold text-emerald-500 uppercase tracking-wider mb-1 flex items-center gap-1",children:[e.jsx(Nt,{className:"w-3 h-3"})," Discount/Bonus"]}),e.jsx("input",{type:"number",value:i.discount,onChange:x=>m({...i,discount:x.target.value}),className:"w-full bg-emerald-50 dark:bg-emerald-900/10 border-none rounded-xl px-4 py-3 text-emerald-600 dark:text-emerald-400 font-bold"})]})]}),i.type==="EMI"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 animate-in slide-in-from-top-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Principal Component"}),e.jsx("input",{type:"number",placeholder:"Suggest: 70%",value:i.principal,onChange:x=>m({...i,principal:x.target.value}),className:"w-full bg-slate-50 dark:bg-slate-800 border-none rounded-xl px-4 py-3 text-slate-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Interest Component"}),e.jsx("input",{type:"number",placeholder:"Suggest: 30%",value:i.interest,onChange:x=>m({...i,interest:x.target.value}),className:"w-full bg-slate-50 dark:bg-slate-800 border-none rounded-xl px-4 py-3 text-slate-900 dark:text-white"})]})]}),i.type==="Penalty"&&e.jsxs("div",{className:"animate-in slide-in-from-top-2",children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Late Fee / Penalty Description"}),e.jsx("textarea",{value:i.notes||"",onChange:x=>m({...i,notes:x.target.value}),placeholder:"e.g. Late fee for March EMI",className:"w-full bg-slate-50 dark:bg-slate-800 border-none rounded-xl px-4 py-3 text-slate-900 dark:text-white text-sm"})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800/50 p-4 rounded-xl border border-slate-100 dark:border-slate-800",children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"Paid From Account"}),e.jsx("select",{value:i.accountId,onChange:x=>m({...i,accountId:x.target.value}),className:"w-full bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-xl px-4 py-3 text-slate-900 dark:text-white",children:c.filter(x=>!x.isArchived).map(x=>e.jsxs("option",{value:x.id,children:[x.name," (₹",x.balance,")"]},x.id))})]}),e.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-slate-400 font-bold uppercase mt-2",children:[e.jsx(Be,{className:"w-3 h-3"}),"Remaining Principal: ₹",j.toLocaleString()]}),e.jsxs("button",{type:"submit",className:"w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-4 rounded-xl mt-2 transition-colors flex items-center justify-center gap-2 shadow-lg shadow-emerald-500/20",children:[e.jsx(Fe,{className:"w-5 h-5"}),"Record & Log Finance"]})]})]})})},ts=({isOpen:l,onClose:s,loan:a})=>{if(L(l),!l||!a)return null;const t=(()=>{const d=[];let c=a.totalLoanAmount;const i=a.interestRate/100/12,m=a.emiAmount,r=a.startDate?new Date(a.startDate):new Date,j=a.dueDateDay||r.getDate(),u=a.interestType!=="flat";for(let f=1;f<=a.tenureMonths;f++){let x=0,k=0;u?(x=c*i,k=m-x):(x=a.totalLoanAmount*(a.interestRate/100)*(a.tenureMonths/12)/a.tenureMonths,k=m-x),(c-k<0||f===a.tenureMonths)&&(k=c,u||(x=m-k)),c-=k;const p=ot(r,f-1);if(j<=28&&p.setDate(j),d.push({month:f,date:p,emi:k+x,principal:k,interest:x,balance:Math.max(0,c)}),c<=0)break}return d})();return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-2xl w-full max-w-2xl h-[80vh] flex flex-col shadow-2xl border border-slate-100 dark:border-slate-800 animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"p-4 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center bg-slate-900 text-white rounded-t-2xl",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(Be,{className:"w-5 h-5 text-indigo-400"}),"Amortization Schedule"]}),e.jsxs("p",{className:"text-xs text-slate-400",children:[a.lender," - ₹",a.totalLoanAmount.toLocaleString()," @ ",a.interestRate,"% (",a.interestType,")"]})]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-white/10 rounded-full transition-colors",children:e.jsx($,{className:"w-5 h-5 text-slate-400"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-2 relative",children:[e.jsxs("div",{className:"grid grid-cols-5 text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-2 px-2 sticky top-0 bg-white dark:bg-slate-900 py-2 z-10 border-b dark:border-slate-800",children:[e.jsx("span",{children:"Date"}),e.jsx("span",{className:"text-right",children:"EMI"}),e.jsx("span",{className:"text-right text-indigo-500",children:"Principal"}),e.jsx("span",{className:"text-right text-red-400",children:"Interest"}),e.jsx("span",{className:"text-right",children:"Balance"})]}),t.map(d=>e.jsxs("div",{className:"grid grid-cols-5 text-xs p-3 rounded-lg bg-slate-50 dark:bg-slate-800/50 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors items-center",children:[e.jsxs("span",{className:"font-bold text-slate-700 dark:text-slate-300",children:[e.jsxs("span",{className:"text-[10px] text-slate-400 block mb-0.5",children:["Month ",d.month]}),v(d.date,"MMM yyyy")]}),e.jsxs("span",{className:"text-right font-bold dark:text-white",children:["₹",Math.round(d.emi).toLocaleString()]}),e.jsxs("span",{className:"text-right text-indigo-600 dark:text-indigo-400",children:["₹",Math.round(d.principal).toLocaleString()]}),e.jsxs("span",{className:"text-right text-red-500 dark:text-red-400",children:["₹",Math.round(d.interest).toLocaleString()]}),e.jsxs("span",{className:"text-right font-bold text-slate-500 dark:text-slate-400",children:["₹",Math.round(d.balance).toLocaleString()]})]},d.month))]})]})})},ss=({isOpen:l,onClose:s,loan:a,onSavePayment:n})=>{L(l);const[t,d]=b.useState(""),c=b.useMemo(()=>{if(!a||!t||Number(t)<=0)return null;const m=Number(t),r=a.remainingPrincipal,j=a.interestRate/100/12,u=a.emiAmount;if(m>=r)return{type:"closure",savings:0,newTenure:0};let f=r,x=0,k=0;for(;f>0&&x<120;){x++;const w=f*j;k+=w,f-=u-w}let p=r-m,D=0,N=0;for(;p>0&&D<120;){D++;const w=p*j;N+=w,p-=u-w}return{type:"reduction",interestSaved:Math.max(0,k-N),monthsSaved:Math.max(0,x-D),newTenure:D}},[a,t]),i=m=>{m.preventDefault();const r=Number(t);r>0&&(n(a.id,{id:Date.now().toString(),date:new Date().toISOString(),amount:r,principal:r,interest:0,type:"Prepayment",notes:"Principal Prepayment"}),s(),d(""))};return!l||!a?null:e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-2xl w-full max-w-md shadow-2xl border border-slate-100 dark:border-slate-800 animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"p-4 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center bg-slate-900 text-white rounded-t-2xl",children:[e.jsxs("h2",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx($e,{className:"w-5 h-5 text-indigo-400"}),"Prepayment Calculator"]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-white/10 rounded-full transition-colors",children:e.jsx($,{className:"w-5 h-5 text-slate-400"})})]}),e.jsxs("form",{onSubmit:i,className:"p-4 space-y-4",children:[e.jsx("div",{className:"bg-slate-50 dark:bg-slate-800/50 p-4 rounded-xl flex justify-between items-center border border-slate-100 dark:border-slate-800",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-wider mb-1",children:"Current Principal Balance"}),e.jsxs("p",{className:"text-xl font-bold text-slate-900 dark:text-white",children:["₹",a.remainingPrincipal.toLocaleString()]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"Prepayment Amount"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 font-bold",children:"₹"}),e.jsx("input",{type:"number",required:!0,min:"1",max:a.remainingPrincipal,placeholder:"Enter amount...",value:t,onChange:m=>d(m.target.value),className:"w-full bg-slate-50 dark:bg-slate-800 border-none rounded-xl pl-8 pr-4 py-3 text-slate-900 dark:text-white focus:ring-2 focus:ring-indigo-500 font-bold"})]})]}),c&&c.type==="reduction"&&e.jsxs("div",{className:"bg-emerald-50 dark:bg-emerald-900/20 p-4 rounded-xl border border-emerald-100 dark:border-emerald-800 space-y-3",children:[e.jsxs("h4",{className:"text-xs font-bold text-emerald-800 dark:text-emerald-400 uppercase tracking-wider flex items-center gap-2",children:["Projected Savings ",e.jsx(ct,{className:"w-3 h-3"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-emerald-600 dark:text-emerald-500 font-bold uppercase",children:"Interest Saved"}),e.jsxs("p",{className:"text-lg font-bold text-emerald-900 dark:text-emerald-100",children:["₹",Math.round(c.interestSaved).toLocaleString()]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-[10px] text-emerald-600 dark:text-emerald-500 font-bold uppercase",children:"Tenure Reduced By"}),e.jsxs("p",{className:"text-lg font-bold text-emerald-900 dark:text-emerald-100",children:[c.monthsSaved," ",e.jsx("span",{className:"text-xs",children:"months"})]})]})]})]}),c&&c.type==="closure"&&e.jsxs("div",{className:"bg-indigo-50 dark:bg-indigo-900/20 p-4 rounded-xl border border-indigo-100 dark:border-indigo-800 text-center",children:[e.jsx("h4",{className:"font-bold text-indigo-900 dark:text-indigo-100",children:"Full Loan Closure"}),e.jsx("p",{className:"text-xs text-indigo-700 dark:text-indigo-300 mt-1",children:"This payment will completely settle the remaining principal."})]}),e.jsxs("button",{type:"submit",disabled:!t,className:`w-full py-4 rounded-xl font-bold transition-all flex items-center justify-center gap-2 ${t?"bg-indigo-600 hover:bg-indigo-700 text-white shadow-lg shadow-indigo-500/30":"bg-slate-100 dark:bg-slate-800 text-slate-400 cursor-not-allowed"}`,children:[e.jsx(be,{className:"w-5 h-5"}),"Record Prepayment"]})]})]})})},Cs=()=>{const l=xt(),{vehicles:s,addVehicle:a,updateVehicle:n,toggleArchiveVehicle:t,setVehicleActive:d,getActiveVehicle:c,serviceRecords:i,followUps:m,getVehicleStats:r,getLoanForVehicle:j,getLoanDetailedStatus:u,addLoan:f,payEMI:x,deleteVehicle:k,deleteServiceRecord:p}=se(),{showToast:D}=mt(),[N,w]=b.useState("dashboard"),[S,T]=b.useState(!1),[h,A]=b.useState(!1),[o,y]=b.useState(!1),[M,I]=b.useState(!1),[E,G]=b.useState(!1),[ae,le]=b.useState(null),[Ye,re]=b.useState(!1),[He,X]=b.useState(!1),[Ze,he]=b.useState(!1),[Ke,pe]=b.useState(!1),[Y,q]=b.useState(null),[ge,fe]=b.useState(null),[as,je]=b.useState(!1),C=c(),F=C?j(C.id):null,Ne=F?u(F.id):null,V=C?r(C.id):null,ne=C?m.filter(g=>g.vehicleId===C.id&&g.status!=="completed"):[];let ie=ne.find(g=>(g.type||"").toLowerCase().includes("service")||(g.type||"").toLowerCase().includes("oil"));!ie&&ne.length>0&&(ie=ne[0]);const de=V?.trendData||[],Je=de.length&&Math.max(...de.map(g=>g.cost))||1,[oe,Ge]=b.useState("All");let _=[...i];oe!=="All"&&(_=_.filter(g=>g.type.toLowerCase()===oe.toLowerCase())),_.sort((g,P)=>new Date(P.date)-new Date(g.date));const{selectedIds:B,isSelectionMode:Q,toggleSelection:Xe,enterSelectionMode:Qe,exitSelectionMode:ke,toggleSelectAll:et}=yt(_.map(g=>g.id)),we=b.useRef(),ce=b.useRef(),ye=[...s].sort((g,P)=>g.isActive?-1:P.isActive?1:0);b.useEffect(()=>{const g=P=>{we.current&&!we.current.contains(P.target)&&T(!1),ce.current&&!ce.current.contains(P.target)&&A(!1)};return document.addEventListener("mousedown",g),()=>document.removeEventListener("mousedown",g)},[]);const ve=g=>{ae?n(ae.id,g):a(g),I(!1),le(null)},De=(g,P)=>{x(g,P),X(!1)},tt=async()=>{je(!0);try{await Promise.all(B.map(g=>p(g))),D(`Deleted ${B.length} entries`,"success"),ke()}catch{D("Failed to delete some entries","error")}finally{je(!1),q(null)}},st=g=>z;return s.length===0?e.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-950 p-6 flex flex-col items-center justify-center",children:[e.jsx("div",{className:"w-24 h-24 bg-indigo-100 dark:bg-indigo-900/30 rounded-full flex items-center justify-center mb-6",children:e.jsx(z,{className:"w-12 h-12 text-indigo-600 dark:text-indigo-400"})}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white mb-3",children:"Vehicle Management"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 mb-8 text-center max-w-xs",children:"Track expenses, maintenance, and reminders for your fleet."}),e.jsxs(O,{onClick:()=>I(!0),scaleDown:.96,className:"px-8 py-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-2xl font-bold shadow-lg shadow-indigo-500/30 transition-all flex items-center gap-2",children:[e.jsx(U,{className:"w-5 h-5"})," Add First Vehicle"]}),e.jsx(Re,{isOpen:M,onClose:()=>I(!1),onSave:ve})]}):e.jsx(ut,{bottomNav:e.jsx(ht,{items:[{id:"app-home",icon:pt,label:"AWAKE",onClick:()=>l("/")},{id:"service",icon:kt,label:"Service",isActive:N==="service",onClick:()=>w("service")},{id:"dashboard",icon:z,label:"Dashboard",isActive:N==="dashboard",onClick:()=>w("dashboard"),isPrimary:!0},{id:"loan",icon:K,label:"Loan",isActive:N==="loan",onClick:()=>w("loan")},{id:"more",icon:St,label:"More",onClick:()=>l("/vehicle/more")}]}),renderFloating:e.jsxs(e.Fragment,{children:[N==="dashboard"&&e.jsxs(O,{onClick:()=>alert("Add Entry: Full ledger entry modal coming soon"),scaleDown:.96,className:"fixed right-6 bg-indigo-600 text-white px-5 py-3 rounded-2xl shadow-xl shadow-indigo-600/30 flex items-center justify-center gap-2 hover:scale-105 transition-transform z-40 font-bold text-sm",style:{bottom:"calc(env(safe-area-inset-bottom, 0px) + 96px)"},children:[e.jsx(U,{className:"w-5 h-5"})," Add Entry"]}),N==="service"&&e.jsxs(O,{onClick:()=>alert("Add Reminder Modal Coming Soon"),scaleDown:.96,className:"fixed right-6 bg-blue-600 text-white px-5 py-3 rounded-2xl shadow-xl shadow-blue-600/30 flex items-center justify-center gap-2 hover:scale-105 transition-transform z-40 font-bold text-sm",style:{bottom:"calc(env(safe-area-inset-bottom, 0px) + 96px)"},children:[e.jsx(U,{className:"w-5 h-5"})," Add Reminder"]}),N==="loan"&&F&&e.jsxs(O,{onClick:()=>X(!0),scaleDown:.96,className:"fixed right-6 bg-slate-900 dark:bg-white text-white dark:text-slate-900 px-5 py-3 rounded-2xl shadow-xl flex items-center justify-center gap-2 hover:scale-105 transition-transform z-40 font-bold text-sm",style:{bottom:"calc(env(safe-area-inset-bottom, 0px) + 96px)"},children:[e.jsx(U,{className:"w-5 h-5"})," Record EMI"]}),e.jsx(Re,{isOpen:M,onClose:()=>{I(!1),le(null)},onSave:ve,editVehicle:ae}),e.jsx(Xt,{isOpen:E,onClose:()=>G(!1),setEditingVehicle:le,setIsAddOpen:I,setDeleteConfirmId:q}),e.jsx(Qt,{isOpen:Ye,onClose:()=>re(!1),onSave:g=>{f(g),re(!1)},vehicle:C}),e.jsx(es,{isOpen:He,onClose:()=>X(!1),onSave:De,loan:F,vehicle:C,loanDetail:Ne}),e.jsx(ts,{isOpen:Ze,onClose:()=>he(!1),loan:F}),e.jsx(ss,{isOpen:Ke,onClose:()=>pe(!1),loan:F,onSavePayment:De}),e.jsx(Pe,{isOpen:!!Y,onClose:()=>q(null),onConfirm:Y==="bulk"?tt:()=>{k(Y),q(null)},title:Y==="bulk"?`Delete ${B.length} Entries?`:"Delete Vehicle?",message:Y==="bulk"?"Are you sure you want to delete these records? This action cannot be undone.":"Are you sure you want to permanently delete this vehicle? All related data will be lost."}),e.jsx(Pe,{isOpen:!!ge,onClose:()=>fe(null),onConfirm:()=>{t(ge),fe(null)},title:"Archive Vehicle?",message:"Are you sure you want to archive this vehicle? It will be hidden from the main view.",confirmLabel:"Archive"})]}),title:Q?void 0:"Vehicle",header:Q?e.jsx(vt,{count:B.length,onCancel:ke,onSelectAll:et,isAllSelected:B.length===_.length,actions:e.jsx("button",{onClick:()=>q("bulk"),className:"p-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 rounded-xl transition-colors",children:e.jsx(bt,{className:"w-5 h-5"})})}):void 0,rightNode:Q?null:e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"relative",ref:ce,children:[e.jsxs(O,{onClick:()=>A(!h),scaleDown:.96,className:"flex items-center gap-2 bg-slate-100 dark:bg-slate-900 border border-slate-200 dark:border-slate-800 px-3 py-1.5 rounded-full hover:bg-white dark:hover:bg-slate-800 transition-colors shadow-sm",children:[e.jsx("span",{className:"font-bold text-slate-800 dark:text-slate-200 text-[11px] leading-tight max-w-[80px] truncate uppercase tracking-tight",children:C?C.name:"Select"}),e.jsx(Mt,{className:"w-3 h-3 text-slate-500"})]}),e.jsx(ze,{children:h&&e.jsx(te.div,{initial:{opacity:0,scale:.95,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:10},className:"absolute right-0 mt-2 w-56 bg-white dark:bg-slate-900 rounded-2xl shadow-2xl border border-slate-200 dark:border-slate-800 overflow-hidden z-50 origin-top-right",children:e.jsxs("div",{className:"p-2 space-y-1",children:[e.jsx("div",{className:"px-3 py-1.5 text-[10px] font-black text-slate-400 uppercase tracking-widest",children:"Switch Vehicle"}),ye.filter(g=>!g.isArchived).map(g=>e.jsxs(O,{onClick:()=>{d(g.id),A(!1)},scaleDown:.98,className:`w-full flex items-center gap-3 p-2 rounded-xl transition-colors ${g.isActive?"bg-indigo-50 dark:bg-indigo-900/30":"hover:bg-slate-50 dark:hover:bg-slate-800/50"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center shrink-0 ${g.isActive?"bg-indigo-500 text-white":"bg-slate-100 dark:bg-slate-800 text-slate-400"}`,children:e.jsx(z,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("p",{className:`text-xs font-bold ${g.isActive?"text-indigo-900 dark:text-indigo-100":"text-slate-700 dark:text-slate-200"}`,children:g.name}),e.jsx("p",{className:"text-[10px] text-slate-500 truncate",children:g.brandModel})]})]},g.id))]})})})]})}),children:e.jsx("div",{children:C?e.jsxs(e.Fragment,{children:[N==="dashboard"&&e.jsxs("div",{className:"bg-gradient-to-br from-slate-900 to-slate-800 dark:from-indigo-900 dark:to-slate-900 rounded-3xl p-5 text-white shadow-xl shadow-slate-900/10 mb-6 relative overflow-hidden",children:[V?.overdueCount>0&&e.jsxs("div",{className:"absolute top-4 right-4 bg-red-500/90 text-white text-[10px] font-bold px-2 py-1 rounded-full flex items-center gap-1 animate-pulse",children:[e.jsx(Dt,{className:"w-3 h-3"}),V.overdueCount," Alerts"]}),e.jsxs("div",{className:"flex divide-x divide-white/10 mt-2",children:[e.jsxs("div",{className:"flex-1 p-2 pl-0 text-left",children:[e.jsx("p",{className:"text-[10px] text-slate-400 uppercase font-bold mb-1 tracking-wider",children:"Month Cost"}),e.jsxs("p",{className:"font-bold text-xl",children:["₹",V?.monthSpend.toLocaleString()]})]}),e.jsxs("div",{className:"flex-1 p-2 text-center",children:[e.jsx("p",{className:"text-[10px] text-slate-400 uppercase font-bold mb-1 tracking-wider",children:"Total Cost"}),e.jsxs("p",{className:"font-bold text-xl",children:["₹",V?.totalSpend.toLocaleString()]})]}),e.jsxs("div",{className:"flex-1 p-2 pr-0 text-right flex flex-col items-end",children:[e.jsx("p",{className:"text-[10px] text-slate-400 uppercase font-bold mb-1 tracking-wider",children:"Cost/Km"}),e.jsxs("p",{className:"font-bold text-xl",children:["₹",V?.costPerKm]})]})]})]}),e.jsxs("main",{className:"pb-16",children:[e.jsx("div",{className:N==="dashboard"?"block":"hidden",children:e.jsx(_t,{activeVehicle:C,trendData:de,maxTrendCost:Je,stats:V,combinedHistory:_,historyFilter:oe,setHistoryFilter:Ge,getIcon:st,sortedVehicles:ye,showArchived:o,setVehicleActive:d,setDeleteConfirmId:q,toggleArchiveVehicle:t,isSelectionMode:Q,selectedIds:B,toggleSelection:Xe,enterSelectionMode:Qe})}),e.jsx("div",{className:N==="service"?"block":"hidden",children:e.jsx(Zt,{activeVehicle:C,nextService:ie,activeTab:N})}),e.jsx("div",{className:N==="loan"?"block":"hidden",children:e.jsx(Kt,{activeLoan:F,activeVehicle:C,loanDetail:Ne,setIsAmortizationOpen:he,setIsPrepaymentOpen:pe,setIsPayEMIOpen:X,setIsAddLoanOpen:re})})]})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-slate-500",children:"No active vehicle found."})})})})};export{Cs as default};
