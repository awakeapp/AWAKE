import{z as xe,o as ue,j as e,r,q as be,l as ge,a9 as he,V as pe,U as d,m as w,C as fe,E as J,A as X,X as ke}from"./index-9msspAXs.js";import{F as we}from"./FinanceBottomNav-DgxfkZ8a.js";import{u as je,S as ve}from"./useSelection-Lbc3MKXR.js";import{I as Ne}from"./ItemMenu-VUnNMYsH.js";import{D as ye}from"./DeleteConfirmationModal-C3Ect0Gz.js";import{S as Ce}from"./search-BDGJpxHy.js";import{U as Pe,a as Se,P as De}from"./user-Cidhjdlr.js";import{P as Ae}from"./plus-CMsmunyR.js";import"./book-open-CJ6BBX_i.js";import"./wallet-B-Jnzj-V.js";import"./ellipsis-CVoln8BK.js";import"./square-check-big-dwW8C68g.js";import"./square-lZ11Ib2v.js";import"./eye-BqTX6Mm8.js";import"./pen-DY3Fb26x.js";import"./triangle-alert-2A0dCFLU.js";const qe=()=>{const y=xe(),C=ue();if(!C||!C.debtParties)return e.jsx("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-950 flex items-center justify-center p-6",children:e.jsxs("div",{className:"animate-pulse flex flex-col items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-slate-200 dark:bg-slate-800 rounded-full mb-4"}),e.jsx("div",{className:"h-4 w-32 bg-slate-200 dark:bg-slate-800 rounded"})]})});const{debtParties:P,addDebtParty:H,deleteDebtParty:L,getPartyBalance:K,getPartyTransactions:O,getPartyStatus:F}=C,[E,u]=r.useState(!1),{showToast:S}=be();ge(E);const{selectedIds:n,isSelectionMode:c,toggleSelection:Y,enterSelectionMode:Z,exitSelectionMode:I,toggleSelectAll:ee}=je(P.map(t=>t.id)),[b,te]=r.useState(""),[D,j]=r.useState(""),[M,g]=r.useState(""),[W,v]=r.useState("+91"),[_,$]=r.useState(""),[A,B]=r.useState(""),[ae,h]=r.useState([]),[se,p]=r.useState(!1),[R,o]=r.useState(""),T=he.useRef(null),[f,k]=r.useState(null),[Te,z]=r.useState(!1),V=typeof navigator<"u"&&"contacts"in navigator&&"ContactsManager"in window,x=r.useCallback(t=>{if(!t)return{code:"+91",number:""};let a=t.replace(/[\s\-\(\)\.]/g,"");if(a.startsWith("+")){if(a.startsWith("+91")&&a.length>=13)return{code:"+91",number:a.slice(3)};if(a.startsWith("+1")&&a.length>=12)return{code:"+1",number:a.slice(2)};if(a.startsWith("+44")&&a.length>=13)return{code:"+44",number:a.slice(3)};if(a.startsWith("+971")&&a.length>=13)return{code:"+971",number:a.slice(4)};if(a.startsWith("+966")&&a.length>=13)return{code:"+966",number:a.slice(4)};const s=a.match(/^(\+\d{1,4})(\d+)$/);if(s)return{code:s[1],number:s[2]}}return a.startsWith("0")&&(a=a.slice(1)),{code:"+91",number:a}},[]),U=r.useCallback(t=>{const a=t.split(/\r?\n/);let s="";const l=[];for(const i of a)if((i.startsWith("FN:")||i.startsWith("FN;"))&&(s=i.split(":").slice(1).join(":").trim()),i.startsWith("TEL")||i.startsWith("tel")){const m=i.split(":").slice(1).join(":").trim();m&&l.push(m)}return{name:s,phones:l}},[]),le=r.useCallback(t=>{const a=t.target.files?.[0];if(!a)return;const s=new FileReader;s.onload=l=>{const i=l.target.result,{name:m,phones:N}=U(i);if(m&&j(m),N.length===1){const{code:ce,number:me}=x(N[0]);v(ce),g(me)}else N.length>1&&(h(N),p(!0))},s.readAsText(a),T.current&&(T.current.value="")},[U,x]),re=r.useCallback(async()=>{o("");try{if(V){const t=["name","tel"],a={multiple:!1},s=await navigator.contacts.select(t,a);if(!s||s.length===0)return;const l=s[0];if(l.name&&l.name.length>0&&j(l.name[0]),l.tel&&l.tel.length>0)if(l.tel.length===1){const{code:i,number:m}=x(l.tel[0]);v(i),g(m)}else h(l.tel),p(!0)}else{const t=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;o(t?"Contact picker not supported on iOS Safari. Please type name/number or use keyboard AutoFill.":"Contact picker not supported on your browser. Please type it manually."),setTimeout(()=>o(""),5e3)}}catch(t){t.name==="SecurityError"||t.name==="NotAllowedError"?(o("Contact access denied. Please allow in device Settings."),setTimeout(()=>o(""),5e3)):t.name!=="AbortError"&&(o("Contact picker error. Please type manually."),setTimeout(()=>o(""),4e3))}},[V,x]),ie=r.useCallback(t=>{const{code:a,number:s}=x(t);v(a),g(s),p(!1),h([])},[x]),ne=(P||[]).filter(t=>!t.is_deleted);let G=0,Q=0;const q=ne.map(t=>{const a=K(t.id),s=O(t.id),l=s.length>0?s[0].date:t.created_at;return F(t.id),a>0?G+=a:a<0&&(Q+=Math.abs(a)),{...t,balance:a,lastTxDate:l}}).sort((t,a)=>new Date(a.lastTxDate).getTime()-new Date(t.lastTxDate).getTime()),oe=async t=>{t.preventDefault(),D&&(await H({name:D,phone_number:M,country_code:W,tag:_,credit_limit:A?Number(A):null,preferred_reminder_method:"whatsapp",last_reminder_sent_at:null}),u(!1),j(""),g(""),$(""),B(""))},de=async()=>{z(!0);try{await Promise.all(n.map(t=>L(t))),S(`Deleted ${n.length} parties`,"success"),I()}catch{S("Failed to delete some parties","error")}finally{z(!1),k(null)}};return e.jsxs(pe,{bottomNav:e.jsx(we,{}),renderFloating:e.jsxs(e.Fragment,{children:[e.jsx(X,{children:E&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end justify-center p-4 pb-24 sm:p-6 sm:items-center",children:[e.jsx(w.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>u(!1),className:"absolute inset-0 bg-black/40 backdrop-blur-sm"}),e.jsxs(w.form,{initial:{y:"100%",opacity:0},animate:{y:0,opacity:1},exit:{y:"100%",opacity:0},transition:{type:"spring",damping:25,stiffness:300},onSubmit:oe,className:"bg-white dark:bg-[#0f172a] w-full max-w-lg rounded-[2.5rem] p-7 shadow-2xl border border-slate-100 dark:border-slate-800 relative z-10 max-h-[85vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white border-b border-slate-100 dark:border-slate-800/50 pb-5 mb-6 leading-tight",children:"New Party Details"}),e.jsx("input",{type:"file",ref:T,accept:".vcf,.vcard",onChange:le,className:"hidden"}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 block",children:"Name"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:D,onChange:t=>j(t.target.value),placeholder:"John Doe",autoComplete:"name",className:"w-full bg-slate-50 dark:bg-slate-800/30 border border-slate-200 dark:border-slate-700/50 rounded-xl p-3.5 pr-12 text-slate-900 dark:text-white font-medium focus:ring-2 focus:ring-indigo-500 shadow-sm",autoFocus:!0}),e.jsx(d,{variant:"primary",type:"button",onClick:re,className:"absolute right-1.5 top-1/2 -translate-y-1/2 w-9 h-9 flex items-center justify-center rounded-lg bg-indigo-50 dark:bg-indigo-500/10 text-indigo-500 hover:bg-indigo-100 dark:hover:bg-indigo-500/20",title:"Import from contacts",iconOnly:!0,children:e.jsx(Se,{className:"w-4 h-4"})})]}),R&&e.jsxs("p",{className:"text-[11px] text-amber-600 dark:text-amber-400 font-medium mt-1.5 flex items-center gap-1",children:[e.jsx("span",{className:"shrink-0",children:"⚠"})," ",R]})]}),e.jsxs("div",{className:"grid grid-cols-[100px_1fr] gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 block",children:"Code"}),e.jsx("input",{type:"text",value:W,onChange:t=>v(t.target.value),placeholder:"+91",className:"w-full bg-slate-50 dark:bg-slate-800/30 border border-slate-200 dark:border-slate-700/50 rounded-xl p-3.5 text-slate-900 dark:text-white font-medium focus:ring-2 focus:ring-indigo-500 shadow-sm text-center"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 block",children:"Phone No. (Opt)"}),e.jsx("input",{type:"tel",value:M,onChange:t=>g(t.target.value),placeholder:"9876543210",autoComplete:"tel",className:"w-full bg-slate-50 dark:bg-slate-800/30 border border-slate-200 dark:border-slate-700/50 rounded-xl p-3.5 text-slate-900 dark:text-white font-medium focus:ring-2 focus:ring-indigo-500 shadow-sm"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 block",children:"Tag (Opt)"}),e.jsx("input",{type:"text",value:_,onChange:t=>$(t.target.value),placeholder:"Vendor, Friend",className:"w-full bg-slate-50 dark:bg-slate-800/30 border border-slate-200 dark:border-slate-700/50 rounded-xl p-3.5 text-slate-900 dark:text-white font-medium focus:ring-2 focus:ring-indigo-500 shadow-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 block",children:"Cred. Limit (Opt)"}),e.jsx("input",{type:"number",value:A,onChange:t=>B(t.target.value),placeholder:"₹0",className:"w-full bg-slate-50 dark:bg-slate-800/30 border border-slate-200 dark:border-slate-700/50 rounded-xl p-3.5 text-slate-900 dark:text-white font-medium focus:ring-2 focus:ring-indigo-500 shadow-sm"})]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-8",children:[e.jsx(d,{variant:"back",onClick:()=>u(!1),label:"Cancel",iconOnly:!1,className:"flex-1 py-4 font-bold text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-800 rounded-xl"}),e.jsx(d,{variant:"primary",type:"submit",label:"Save Party",iconOnly:!1,className:"flex-[2] py-4 bg-indigo-600 hover:bg-indigo-500 text-white font-black rounded-xl shadow-lg shadow-indigo-500/30"})]})]})]})}),e.jsx(X,{children:se&&e.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-6",children:[e.jsx(w.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>{p(!1),h([])},className:"absolute inset-0 bg-black/50 backdrop-blur-sm"}),e.jsxs(w.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white dark:bg-slate-900 w-full max-w-xs rounded-2xl shadow-2xl border border-slate-100 dark:border-slate-800 relative z-10 overflow-hidden",children:[e.jsxs("div",{className:"p-5 border-b border-slate-100 dark:border-slate-800 flex items-center justify-between",children:[e.jsx("h4",{className:"text-base font-bold text-slate-900 dark:text-white",children:"Select Number"}),e.jsx("button",{onClick:()=>{p(!1),h([])},className:"p-1 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full transition-colors",children:e.jsx(ke,{className:"w-4 h-4 text-slate-400"})})]}),e.jsx("div",{className:"p-2 max-h-60 overflow-y-auto",children:ae.map((t,a)=>e.jsxs("button",{onClick:()=>ie(t),className:"w-full flex items-center gap-3 px-4 py-3.5 text-left hover:bg-slate-50 dark:hover:bg-slate-800 rounded-xl transition-colors",children:[e.jsx("div",{className:"w-9 h-9 rounded-full bg-indigo-50 dark:bg-indigo-500/10 flex items-center justify-center shrink-0",children:e.jsx(De,{className:"w-4 h-4 text-indigo-500"})}),e.jsx("span",{className:"text-sm font-bold text-slate-900 dark:text-white",children:t})]},a))})]})]})})]}),title:c?void 0:"Debts & Lending",header:c?e.jsx(ve,{count:n.length,onCancel:I,onSelectAll:ee,isAllSelected:n.length===P.length,actions:e.jsx(d,{variant:"delete",onClick:()=>k("bulk"),className:"p-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 rounded-xl"})}):void 0,showBack:!c,rightNode:c?null:e.jsx(d,{variant:"primary",onClick:()=>u(!0),className:"p-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-full shadow-sm shadow-indigo-500/30",children:e.jsx(Ae,{className:"w-5 h-5"})}),children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-emerald-50 text-emerald-900 dark:bg-emerald-500/10 dark:text-emerald-100 p-4 rounded-[1.5rem] shadow-sm border border-emerald-100 dark:border-emerald-500/20",children:[e.jsx("p",{className:"text-[9px] font-black uppercase tracking-[0.15em] opacity-60 mb-1",children:"To Get"}),e.jsxs("h2",{className:"text-xl font-black",children:["₹",G.toLocaleString()]})]}),e.jsxs("div",{className:"bg-red-50 text-red-900 dark:bg-red-500/10 dark:text-red-100 p-4 rounded-[1.5rem] shadow-sm border border-red-100 dark:border-red-500/20",children:[e.jsx("p",{className:"text-[9px] font-black uppercase tracking-[0.15em] opacity-60 mb-1",children:"To Pay"}),e.jsxs("h2",{className:"text-xl font-black",children:["₹",Q.toLocaleString()]})]})]}),e.jsxs("div",{className:"relative mb-3",children:[e.jsx("input",{type:"text",value:b,onChange:t=>te(t.target.value),placeholder:"Search parties...",className:"w-full bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-xl py-2.5 pl-10 pr-4 text-sm font-medium text-slate-900 dark:text-white focus:ring-2 focus:ring-indigo-500 shadow-sm"}),e.jsx(Ce,{className:"w-4 h-4 text-slate-400 absolute left-3.5 top-1/2 -translate-y-1/2"})]})]}),e.jsx("div",{className:"space-y-3",children:q.filter(t=>t.name.toLowerCase().includes(b.toLowerCase())||t.tag&&t.tag.toLowerCase().includes(b.toLowerCase())).length===0?e.jsxs("div",{className:"text-center py-16 px-6",children:[e.jsx("div",{className:"w-20 h-20 bg-indigo-50 dark:bg-indigo-900/20 rounded-full flex items-center justify-center mx-auto mb-6 text-indigo-300",children:e.jsx(Pe,{className:"w-10 h-10"})}),e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white mb-2",children:"No parties found"}),e.jsx("p",{className:"text-slate-500 text-sm mb-8 leading-relaxed max-w-xs mx-auto",children:"Add friends, clients, or businesses you lend to or borrow from."}),e.jsx(d,{variant:"primary",onClick:()=>u(!0),label:"+ Add Party",iconOnly:!1,className:"bg-indigo-600 text-white px-8 py-4 rounded-2xl font-bold shadow-xl shadow-indigo-500/20"})]}):q.filter(t=>t.name.toLowerCase().includes(b.toLowerCase())||t.tag&&t.tag.toLowerCase().includes(b.toLowerCase())).map(t=>{const a=t.balance,s=a>0,l=a===0;return F(t.id),e.jsxs(w.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},onClick:()=>c&&Y(t.id),onContextMenu:i=>{i.preventDefault(),Z(t.id)},className:J("bg-white dark:bg-slate-900 p-5 rounded-3xl shadow-sm border transition-all flex flex-col gap-4 relative overflow-hidden group cursor-pointer",n.includes(t.id)?"border-indigo-500 ring-2 ring-indigo-500/20":"border-slate-100 dark:border-slate-800"),children:[e.jsx("div",{className:`absolute top-0 right-0 w-32 h-32 -mr-16 -mt-16 blur-3xl opacity-[0.03] pointer-events-none rounded-full ${l?"bg-slate-400":s?"bg-emerald-500":"bg-red-500"}`}),e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[c&&e.jsx("div",{className:J("w-5 h-5 rounded-full border flex items-center justify-center shrink-0 transition-colors",n.includes(t.id)?"bg-indigo-600 border-indigo-600":"border-slate-300 dark:border-slate-700"),children:n.includes(t.id)&&e.jsx(fe,{className:"w-3 h-3 text-white"})}),e.jsx("h4",{className:"text-lg font-black text-slate-900 dark:text-white capitalize truncate leading-tight tracking-tight",children:t.name})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1.5 overflow-hidden",children:[e.jsx("span",{className:"text-[10px] text-slate-400 font-bold uppercase tracking-wider whitespace-nowrap",children:new Date(t.lastTxDate).toLocaleDateString([],{month:"short",day:"numeric"})}),e.jsx("span",{className:"w-1 h-1 rounded-full bg-slate-200 dark:bg-slate-800 shrink-0"}),e.jsxs("span",{className:"text-[10px] text-slate-400 font-bold uppercase tracking-wider whitespace-nowrap",children:[O(t.id).length," Entries"]}),t.tag&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-1 h-1 rounded-full bg-slate-200 dark:bg-slate-800 shrink-0"}),e.jsx("span",{className:"text-[10px] bg-slate-50 dark:bg-slate-800/50 px-1.5 py-0.5 rounded text-slate-500 truncate",children:t.tag})]})]})]}),e.jsxs("div",{className:"text-right shrink-0 flex flex-col items-end gap-2",children:[!c&&e.jsx(Ne,{onEdit:()=>y(`/finance/debts/${t.id}`),onDelete:()=>k(t.id)}),l?e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400 px-2.5 py-1 bg-slate-50 dark:bg-slate-800 rounded-lg",children:"Settled"}):e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsxs("p",{className:`text-xl font-black tracking-tightest leading-none ${s?"text-emerald-600 dark:text-emerald-500":"text-red-600 dark:text-red-500"}`,children:["₹",Math.abs(a).toLocaleString()]}),e.jsx("p",{className:`text-[9px] font-black uppercase tracking-[0.15em] mt-1.5 ${s?"text-emerald-500/60":"text-red-500/60"}`,children:s?"To Get":"To Pay"})]})]})]}),e.jsxs("div",{className:"flex gap-2.5 mt-1 pt-4 border-t border-slate-50 dark:border-slate-800/50",children:[e.jsx(d,{variant:"ghost",onClick:i=>{i.stopPropagation(),y(`/finance/debts/${t.id}`)},label:"View",iconOnly:!1,className:"flex-1 py-2.5 bg-slate-50 dark:bg-slate-800/50 hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-600 dark:text-slate-300 text-xs font-bold uppercase tracking-wider rounded-xl"}),e.jsx(d,{variant:"primary",onClick:i=>{i.stopPropagation(),y(`/finance/debts/${t.id}`,{state:{openAdd:!0}})},label:"Add Entry",iconOnly:!1,className:"flex-1 py-2.5 bg-indigo-50 dark:bg-indigo-500/10 hover:bg-indigo-100 dark:hover:bg-indigo-500/20 text-indigo-600 dark:text-indigo-400 text-xs font-bold uppercase tracking-wider rounded-xl"})]})]},t.id)})}),e.jsx(ye,{isOpen:!!f,onClose:()=>k(null),onConfirm:f==="bulk"?de:()=>{L(f),k(null),S("Party deleted","success")},title:f==="bulk"?`Delete ${n.length} Parties?`:"Delete Party?",message:f==="bulk"?"Are you sure you want to delete these parties? All transaction history will be lost.":"Are you sure you want to delete this party? All related transaction history will be lost."})]})};export{qe as default};
