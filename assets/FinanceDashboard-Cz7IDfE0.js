import{w as N,x as V,e as we,r as o,y as q,q as ne,j as e,A as de,m as X,X as Y,h as Ne,al as ye,n as ke,ab as Se,ac as Ce,am as Me,a4 as Ae,P as De,Q as $e,T as re,W as Ie,af as Re}from"./main-C3a15kTs.js";import{T as Be}from"./triangle-alert-Csi8TBB0.js";import{R as _e}from"./refresh-cw-DHwMrpRl.js";import{M as Te,B as ze,S as Pe,T as Le}from"./trash-2-BJhqq1Yq.js";import{S as Ue}from"./smartphone-DZ2ke2Is.js";import{d as Fe}from"./differenceInDays-B8ePxY8j.js";import{T as Oe}from"./trending-up-Ch5SVKRE.js";import{P as Ee}from"./plus-BM30_bg2.js";import{s as qe}from"./subMonths-C6kp2joA.js";const We=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],He=N("arrow-down",We);const Ve=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],Qe=N("credit-card",Ve);const Ze=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Ke=N("file-text",Ze);const Xe=[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]],Ye=N("monitor",Xe);const Ge=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],Je=N("pause",Ge);const et=[["path",{d:"M11 17h3v2a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-3a3.16 3.16 0 0 0 2-2h1a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1h-1a5 5 0 0 0-2-4V3a4 4 0 0 0-3.2 1.6l-.3.4H11a6 6 0 0 0-6 6v1a5 5 0 0 0 2 4v3a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1z",key:"1piglc"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M2 8v1a2 2 0 0 0 2 2h1",key:"1env43"}]],tt=N("piggy-bank",et);const st=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],at=N("play",st);const lt=[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]],nt=N("repeat",lt);const rt=[["path",{d:"M16 3h5v5",key:"1806ms"}],["path",{d:"M8 3H3v5",key:"15dfkv"}],["path",{d:"M12 22v-8.3a4 4 0 0 0-1.172-2.872L3 3",key:"1qrqzj"}],["path",{d:"m15 9 6-6",key:"ko1vev"}]],ot=N("split",rt);const it=[["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],dt=N("trash",it);const ct=[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]],xt=N("undo",ct),mt=({isOpen:j,onClose:y,editTransactionId:c=null,onDelete:$})=>{const{addTransaction:k,addTransfer:r,editTransaction:x,deleteTransaction:S,checkDuplicate:h,categories:_,accounts:C,transactions:M,addRecurringRule:I,getBudgetStats:A}=V(),{user:D}=we(),[v,w]=o.useState(""),[m,R]=o.useState("expense"),[b,s]=o.useState(""),[l,p]=o.useState(""),[u,a]=o.useState(""),[d,f]=o.useState(""),[T,U]=o.useState(q(new Date,"yyyy-MM-dd")),[L,F]=o.useState(null),[g,z]=o.useState(null),[W,G]=o.useState(!1),[J,ce]=o.useState("monthly"),[ee,xe]=o.useState(""),[P,te]=o.useState(!1),[B,Q]=o.useState([{categoryId:"",amount:""}]),[Z,K]=o.useState(null);o.useEffect(()=>{!c&&D&&ne.getDocument(`users/${D.uid}/config`,"ui").then(t=>{t&&t.lastUsedAccountId&&C.some(n=>n.id===t.lastUsedAccountId)&&p(t.lastUsedAccountId)})},[C,c,D]),o.useEffect(()=>{if(c){const t=M.find(n=>n.id===c);t&&(w(t.amount),R(t.type),p(t.type==="transfer"?t.fromAccountId:t.accountId),t.type==="transfer"?a(t.toAccountId):s(t.categoryId),f(t.note),t.date&&U(q(new Date(t.date),"yyyy-MM-dd")),t.receipt&&(F(t.receipt),z(t.receipt)))}},[c,M]);const me=t=>{const n=t.target.files[0];if(!n)return;if(n.size>100*1024){alert("File too large (max 100KB for now)");return}const i=new FileReader;i.onloadend=()=>{F(i.result),z(i.result)},i.readAsDataURL(n)},ue=()=>Q([...B,{categoryId:"",amount:""}]),he=t=>{const n=[...B];n.splice(t,1),Q(n)},se=(t,n,i)=>{const E=[...B];E[t][n]=i,Q(E)},be=B.reduce((t,n)=>t+(Number(n.amount)||0),0),ae=Number(v)-be,ge=t=>w(t.toString()),le=t=>{t.preventDefault();const n=Number(v);if(!v||isNaN(n))return;if(!c&&!Z){const E=h({amount:n,type:m,categoryId:b,toAccountId:u});if(E){K(E);return}}const i={amount:n,type:m,note:d,date:new Date(T).toISOString(),receipt:L};if(m==="transfer"){if(!l||!u||l===u)return;c?x(c,{...i,fromAccountId:l,toAccountId:u}):r({...i,fromAccountId:l,toAccountId:u})}else{if(!b||!l)return;c?x(c,{...i,categoryId:b,accountId:l}):W?I({frequency:J,startDate:i.date,endDate:ee||null,transactionTemplate:{...i,categoryId:P?null:b,accountId:l,splits:P?B:null}}):k({...i,categoryId:P?"cat_split":b,accountId:l,splits:P?B:null,mode:"manual"}),D&&ne.setItem(`users/${D.uid}/config`,"ui",{lastUsedAccountId:l},!0)}y()},H=C.filter(t=>!t.isArchived),pe=_.filter(t=>t.type==="expense"),fe=_.filter(t=>t.type==="income"),O=m==="expense"?pe:fe,je=o.useMemo(()=>{if(!M.length)return O.slice(0,4);const t={};return M.forEach(n=>{n.categoryId&&(t[n.categoryId]=(t[n.categoryId]||0)+1)}),O.map(n=>({...n,count:t[n.id]||0})).sort((n,i)=>i.count-n.count).slice(0,4)},[M,O]),ve=[100,500,1e3,2e3];return e.jsx(de,{children:j&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center pointer-events-none",children:[e.jsx(X.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:y,className:"absolute inset-0 bg-black/60 backdrop-blur-sm pointer-events-auto"}),e.jsxs(X.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},className:"bg-white dark:bg-slate-900 w-full max-w-md rounded-t-[2rem] p-6 shadow-2xl pointer-events-auto relative max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:c?"Edit Transaction":"Add Transaction"}),e.jsx("button",{onClick:y,className:"p-2 bg-slate-100 dark:bg-slate-800 rounded-full",children:e.jsx(Y,{className:"w-5 h-5"})})]}),Z&&e.jsxs("div",{className:"mb-6 p-4 bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-xl flex gap-3 items-start animate-in fade-in slide-in-from-top-2",children:[e.jsx(Be,{className:"w-5 h-5 text-orange-500 shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-orange-800 dark:text-orange-200 text-sm",children:"Potential Duplicate"}),e.jsxs("p",{className:"text-xs text-orange-600 dark:text-orange-300 mt-1",children:["We found a similar transaction of â‚¹",Z.amount," created recently."]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx("button",{onClick:()=>K(null),className:"px-3 py-1.5 bg-white dark:bg-slate-800 text-xs font-bold rounded-lg shadow-sm",children:"Cancel"}),e.jsx("button",{onClick:t=>{K(null),le(t)},className:"px-3 py-1.5 bg-orange-500 text-white text-xs font-bold rounded-lg shadow-sm",children:"Save Anyway"})]})]})]}),e.jsx("div",{className:"flex bg-slate-100 dark:bg-slate-800 p-1 rounded-xl mb-6",children:["expense","income","transfer"].map(t=>e.jsx("button",{onClick:()=>{R(t),te(!1),G(!1)},className:`flex-1 py-2 text-sm font-bold capitalize rounded-lg transition-all ${m===t?"bg-white dark:bg-slate-700 shadow-sm text-slate-900 dark:text-white":"text-slate-500"}`,children:t},t))}),m==="expense"&&!c&&e.jsxs("div",{className:"flex gap-4 mb-4",children:[e.jsxs("button",{type:"button",onClick:()=>G(!W),className:`flex-1 flex items-center justify-center gap-2 py-2 rounded-xl text-xs font-bold border transition-colors ${W?"bg-indigo-50 border-indigo-500 text-indigo-600":"bg-white border-slate-200 text-slate-500"}`,children:[e.jsx(nt,{className:"w-3.5 h-3.5"}),"Recurring Rule"]}),e.jsxs("button",{type:"button",onClick:()=>te(!P),className:`flex-1 flex items-center justify-center gap-2 py-2 rounded-xl text-xs font-bold border transition-colors ${P?"bg-indigo-50 border-indigo-500 text-indigo-600":"bg-white border-slate-200 text-slate-500"}`,children:[e.jsx(ot,{className:"w-3.5 h-3.5"}),"Split Bill"]})]}),e.jsxs("form",{onSubmit:le,className:"space-y-5",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 block",children:"Amount"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-xl font-bold text-slate-400",children:"â‚¹"}),e.jsx("input",{type:"number",value:v,onChange:t=>w(t.target.value),className:"w-full bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded-2xl py-3 pl-10 pr-4 text-xl font-bold text-slate-900 dark:text-white focus:ring-2 focus:ring-indigo-500 focus:outline-none",placeholder:"0",autoFocus:!c})]})]}),e.jsxs("div",{className:"w-1/3",children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 block",children:"Date"}),e.jsx("div",{className:"relative",children:e.jsx("input",{type:"date",value:T,onChange:t=>U(t.target.value),className:"w-full bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded-2xl py-3 px-3 text-sm font-bold text-slate-900 dark:text-white focus:ring-2 focus:ring-indigo-500 outline-none"})})]})]}),W&&e.jsx("div",{className:"bg-indigo-50 dark:bg-indigo-900/20 p-4 rounded-xl space-y-3 animate-in fade-in slide-in-from-top-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-bold text-indigo-400 uppercase tracking-wider mb-2 block",children:"Frequency"}),e.jsxs("select",{value:J,onChange:t=>ce(t.target.value),className:"w-full bg-white dark:bg-slate-800 border border-indigo-200 dark:border-indigo-800 rounded-xl p-2 text-sm font-medium focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"yearly",children:"Yearly"})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-bold text-indigo-400 uppercase tracking-wider mb-2 block",children:"End Date (Optional)"}),e.jsx("input",{type:"date",value:ee,onChange:t=>xe(t.target.value),className:"w-full bg-white dark:bg-slate-800 border border-indigo-200 dark:border-indigo-800 rounded-xl p-2 text-sm font-medium focus:ring-2 focus:ring-indigo-500"})]})]})}),e.jsx("div",{className:"flex gap-2 overflow-x-auto scrollbar-hide pb-1",children:ve.map(t=>e.jsxs("button",{type:"button",onClick:()=>ge(t),className:"px-3 py-1.5 bg-slate-100 dark:bg-slate-800 rounded-full text-xs font-bold text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors whitespace-nowrap",children:["+ â‚¹",t]},t))}),m==="transfer"?e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 block",children:"From"}),e.jsxs("select",{value:l,onChange:t=>p(t.target.value),className:"w-full bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded-xl p-3 text-sm font-medium focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"Select..."}),H.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 block",children:"To"}),e.jsxs("select",{value:u,onChange:t=>a(t.target.value),className:"w-full bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded-xl p-3 text-sm font-medium focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"Select..."}),H.filter(t=>t.id!==l).map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})]}):P?e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider block",children:"Split Categories"}),B.map((t,n)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:t.categoryId,onChange:i=>se(n,"categoryId",i.target.value),className:"flex-1 bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded-xl p-2 text-sm",children:[e.jsx("option",{value:"",children:"Category..."}),O.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]}),e.jsx("input",{type:"number",value:t.amount,onChange:i=>se(n,"amount",i.target.value),placeholder:"0",className:"w-20 bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded-xl p-2 text-sm"}),B.length>1&&e.jsx("button",{type:"button",onClick:()=>he(n),className:"p-2 text-red-500 hover:bg-red-50 rounded-lg",children:e.jsx(dt,{className:"w-4 h-4"})})]},n)),e.jsxs("div",{className:"flex justify-between items-center text-xs font-bold",children:[e.jsx("button",{type:"button",onClick:ue,className:"text-indigo-500 hover:underline",children:"+ Add Split"}),e.jsxs("span",{className:ae===0?"text-emerald-500":"text-orange-500",children:["Remaining: ",ae]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 block",children:"Account"}),e.jsxs("select",{value:l,onChange:t=>p(t.target.value),className:"w-full bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded-xl p-3 text-sm font-medium focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"Select Account..."}),H.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 block",children:"Category"}),e.jsx("div",{className:"flex gap-2 flex-wrap mb-2",children:je.map(t=>e.jsx("button",{type:"button",onClick:()=>s(t.id),className:`px-2 py-1 rounded-lg text-[10px] font-bold border transition-colors ${b===t.id?"bg-indigo-50 border-indigo-500 text-indigo-600":"bg-white border-slate-200 text-slate-500"}`,children:t.name},t.id))}),e.jsxs("select",{value:b,onChange:t=>s(t.target.value),className:"w-full bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded-xl p-3 text-sm font-medium focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"Select Category..."}),O.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),b&&A(b)&&e.jsx("div",{className:"mt-2 text-xs",children:(()=>{const t=A(b),n=t.status==="danger",i=t.status==="warning";return e.jsxs("div",{className:`p-2 rounded-lg border ${n?"bg-red-50 border-red-200":i?"bg-orange-50 border-orange-200":"bg-slate-50 border-slate-200"}`,children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:`font-bold ${n?"text-red-700":i?"text-orange-700":"text-slate-600"}`,children:n?"Budget Exceeded":i?"Budget Alert":"Monthly Budget"}),e.jsxs("span",{className:"text-slate-500",children:[t.percent,"% used"]})]}),e.jsx("div",{className:"h-1.5 w-full bg-black/5 rounded-full overflow-hidden mb-1",children:e.jsx("div",{className:`h-full rounded-full transition-all ${n?"bg-red-500":i?"bg-orange-500":"bg-emerald-500"}`,style:{width:`${t.percent}%`}})}),e.jsxs("p",{className:"text-slate-500",children:[e.jsx("span",{className:"font-bold text-slate-700",children:Math.abs(t.remaining)})," ",t.remaining>=0?"remaining":"over spent"," of ",t.budget]})]})})()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 block",children:"Account"}),e.jsxs("select",{value:l,onChange:t=>p(t.target.value),className:"w-full bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded-xl p-3 text-sm font-medium focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"Select Account..."}),H.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 block",children:"Note"}),e.jsx("input",{type:"text",value:d,onChange:t=>f(t.target.value),placeholder:"Description...",className:"w-full bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded-xl p-3 text-sm font-medium focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 block",children:"Receipt"}),e.jsxs("label",{className:"flex items-center justify-center w-11 h-11 bg-slate-100 dark:bg-slate-800 rounded-xl cursor-pointer hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors relative overflow-hidden",children:[g?e.jsx("img",{src:g,alt:"Receipt",className:"w-full h-full object-cover opacity-80"}):e.jsx(Ke,{className:"w-5 h-5 text-slate-500"}),e.jsx("input",{type:"file",className:"hidden",onChange:me,accept:"image/*"}),L&&e.jsx("div",{className:"absolute top-0 right-0 w-3 h-3 bg-indigo-500 border-2 border-white rounded-full"})]}),L&&e.jsx("button",{type:"button",onClick:()=>{F(null),z(null)},className:"ml-2 text-[10px] text-red-500 underline",children:"Remove"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[c&&e.jsx("button",{type:"button",onClick:()=>{window.confirm("Delete this transaction?")&&($?$(c):S(c),y())},className:"flex-none py-4 px-5 bg-red-50 dark:bg-red-900/20 text-red-500 dark:text-red-400 font-bold rounded-2xl hover:bg-red-100 dark:hover:bg-red-900/40 transition-colors",children:"Delete"}),e.jsxs("button",{type:"submit",className:"flex-1 bg-slate-900 dark:bg-emerald-500 dark:text-slate-900 text-white font-bold py-4 rounded-2xl shadow-lg flex items-center justify-center gap-2 hover:scale-[1.02] active:scale-[0.98] transition-all",children:[c?"Update Transaction":m==="transfer"?"Transfer Funds":"Save Transaction",e.jsx(Ne,{className:"w-5 h-5"})]})]})]})]})]})})},oe=[{icon:ye,label:"Utility"},{icon:Te,label:"Spotify"},{icon:Ye,label:"Netflix"},{icon:Ue,label:"Phone"},{icon:ze,label:"Work"},{icon:Pe,label:"Shop"},{icon:Qe,label:"Card"}],ie=["from-indigo-500 to-purple-600","from-blue-500 to-cyan-500","from-emerald-500 to-teal-500","from-orange-500 to-red-500","from-pink-500 to-rose-500","from-slate-700 to-slate-900"],ut=()=>{const{subscriptions:j,addSubscription:y,deleteSubscription:c,toggleSubscriptionStatus:$}=V(),[k,r]=o.useState(!1),[x,S]=o.useState(""),[h,_]=o.useState(""),[C,M]=o.useState(""),[I,A]=o.useState(0),[D,v]=o.useState(0),w=s=>{if(s.preventDefault(),!x||!h||!C)return;const l=Number(C);if(l<1||l>31){alert("Please enter a valid day (1-31)");return}console.log("Saving subscription:",{name:x,amount:h,dayNum:l});try{y({name:x,amount:h,dueDate:l,iconIdx:I,colorIdx:D}),r(!1),S(""),_(""),M("")}catch(p){console.error("Failed to save subscription:",p),alert("Failed to save. Please try again.")}},m=s=>{const l=new Date,p=new Date(s),u=Fe(p,l);return u<0?`Overdue ${Math.abs(u)}d`:u===0?"Due Today":u===1?"Tomorrow":`${u} days left`},R=[...j].sort((s,l)=>s.nextBillingDate?new Date(s.nextBillingDate)-new Date(l.nextBillingDate):0),b=j.filter(s=>s.status==="active").reduce((s,l)=>s+Number(l.amount),0);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-2",children:[e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white",children:"Upcoming Payments"}),e.jsx("button",{onClick:()=>r(!0),className:"text-xs text-indigo-500 font-bold uppercase hover:bg-indigo-50 px-2 py-1 rounded-lg transition-colors",children:"+ Add New"})]}),e.jsx("div",{className:"bg-slate-100 dark:bg-slate-800/50 p-4 rounded-2xl flex items-center justify-between mx-2 mb-2",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-200 dark:bg-slate-700 flex items-center justify-center",children:e.jsx(_e,{className:"w-5 h-5 text-slate-500 dark:text-slate-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-400 uppercase font-bold tracking-wider",children:"Monthly Recurring"}),e.jsxs("p",{className:"text-lg font-bold text-slate-900 dark:text-white",children:["â‚¹",b.toLocaleString()]})]})]})}),e.jsxs("div",{className:"overflow-x-auto pb-4 -mx-4 px-4 scrollbar-hide flex gap-3",children:[R.length===0&&!k&&e.jsxs("div",{className:"w-full text-center py-6 border-2 border-dashed border-slate-200 dark:border-slate-800 rounded-2xl",children:[e.jsx("p",{className:"text-slate-400 text-sm mb-2",children:"No upcoming bills."}),e.jsx("button",{onClick:()=>r(!0),className:"text-indigo-500 font-bold text-sm",children:"+ Add Bill"})]}),R.map(s=>{const l=oe[s.iconIdx||0].icon,p=ie[s.colorIdx||0],u=m(s.dueDate);return e.jsxs("div",{className:`min-w-[170px] p-4 rounded-[1.5rem] bg-gradient-to-br ${p} text-white shadow-xl relative group`,children:[e.jsxs("div",{className:"absolute top-3 right-3 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:a=>{a.stopPropagation(),$(s.id)},className:"p-1.5 bg-white/20 rounded-full hover:bg-white/40 transition-colors",title:s.status==="active"?"Pause":"Resume",children:s.status==="active"?e.jsx(Je,{className:"w-3 h-3 text-white"}):e.jsx(at,{className:"w-3 h-3 text-white"})}),e.jsx("button",{onClick:a=>{a.stopPropagation(),c(s.id)},className:"p-1.5 bg-white/20 rounded-full hover:bg-white/40 transition-colors",title:"Delete",children:e.jsx(Le,{className:"w-3 h-3 text-white"})})]}),e.jsx("div",{className:"bg-white/20 w-10 h-10 rounded-full flex items-center justify-center mb-4 backdrop-blur-sm",children:e.jsx(l,{className:"w-5 h-5 text-white"})}),e.jsx("h4",{className:"font-bold text-lg leading-tight mb-1 truncate",children:s.name}),e.jsxs("p",{className:"text-white/80 text-xs font-medium mb-3",children:["â‚¹",Number(s.amount).toLocaleString(),"/mo"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:`bg-black/20 rounded-lg px-2 py-1 inline-block ${s.status!=="active"?"opacity-50":""}`,children:e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-wide text-white/90",children:s.status==="active"?u:"Paused"})}),s.status!=="active"&&e.jsx("span",{className:"text-[10px] font-bold bg-white/20 px-2 py-1 rounded-lg",children:"Paused"})]})]},s.id)})]}),k&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:()=>r(!1)}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-6 rounded-3xl w-full max-w-sm relative z-10 shadow-2xl animate-in zoom-in-95 duration-200",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Add Subscription"}),e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-1 block",children:"Name"}),e.jsx("input",{type:"text",value:x,onChange:s=>S(s.target.value),placeholder:"Netflix",className:"w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl p-3 font-bold",autoFocus:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-1 block",children:"Amount"}),e.jsx("input",{type:"number",value:h,onChange:s=>_(s.target.value),placeholder:"500",className:"w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl p-3 font-bold"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-1 block",children:"Due Day (1-31)"}),e.jsx("input",{type:"number",value:C,onChange:s=>M(s.target.value),placeholder:"15",min:"1",max:"31",className:"w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl p-3 font-bold"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 block",children:"Icon"}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:oe.map((s,l)=>e.jsx("button",{type:"button",onClick:()=>A(l),className:`p-2 rounded-xl border-2 transition-all ${I===l?"border-indigo-500 bg-indigo-50 dark:bg-indigo-900/20":"border-slate-100 dark:border-slate-800"}`,children:e.jsx(s.icon,{className:`w-5 h-5 ${I===l?"text-indigo-600":"text-slate-400"}`})},l))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 block",children:"Color"}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:ie.map((s,l)=>e.jsx("button",{type:"button",onClick:()=>v(l),className:`w-8 h-8 rounded-full bg-gradient-to-br ${s} ring-2 ring-offset-2 ring-offset-white dark:ring-offset-slate-900 transition-all ${D===l?"ring-indigo-500 scale-110":"ring-transparent opacity-70"}`},l))})]}),e.jsx("button",{type:"submit",className:"w-full bg-slate-900 text-white font-bold py-3 rounded-xl mt-4",children:"Save Subscription"})]})]})]})]})},ht=({isOpen:j,onClose:y})=>{const{categories:c,getBudgetStats:$}=V();if(!j)return null;const k=c.filter(r=>r.type==="expense"&&Number(r.budget)>0).map(r=>({...r,stats:$(r.id)})).sort((r,x)=>x.stats.percent-r.stats.percent);return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 w-full max-w-sm rounded-[2rem] p-6 shadow-2xl relative max-h-[80vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 shrink-0",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Monthly Budgets"}),e.jsx("button",{onClick:y,className:"p-2 bg-slate-100 dark:bg-slate-800 rounded-full",children:e.jsx(Y,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"overflow-y-auto space-y-4 pr-2 -mr-2",children:[k.map(r=>{const{stats:x}=r,S=x.status==="danger",h=x.status==="warning";return e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800/50 p-4 rounded-2xl border border-slate-100 dark:border-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm ${r.color?r.color+"/20":"bg-slate-200"} ${r.color?.replace("bg-","text-")||"text-slate-500"}`,children:[r.icon==="Utensils"&&"ðŸ½ï¸",r.icon==="Bus"&&"ðŸšŒ",r.icon==="ShoppingBag"&&"ðŸ›ï¸",r.icon==="Zap"&&"âš¡",!r.icon&&r.name[0]]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-bold text-slate-900 dark:text-white text-sm",children:r.name}),e.jsxs("p",{className:"text-[10px] text-slate-400",children:["Budget: â‚¹",x.budget.toLocaleString()]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:`font-bold text-sm ${S?"text-red-500":h?"text-orange-500":"text-emerald-500"}`,children:[x.percent,"%"]})})]}),e.jsx("div",{className:"h-2 w-full bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden mb-1 relative",children:e.jsx("div",{className:`h-full rounded-full transition-all ${S?"bg-red-500":h?"bg-orange-500":"bg-emerald-500"}`,style:{width:`${x.percent}%`}})}),e.jsxs("div",{className:"flex justify-between text-[10px] font-bold text-slate-400",children:[e.jsxs("span",{children:["Spent: â‚¹",x.spent.toLocaleString()]}),e.jsx("span",{className:S?"text-red-500":"text-slate-400",children:x.remaining>=0?`Left: â‚¹${x.remaining.toLocaleString()}`:`Over: â‚¹${Math.abs(x.remaining).toLocaleString()}`})]})]},r.id)}),k.length===0&&e.jsx("div",{className:"text-center py-10 text-slate-400",children:"No active budgets found."})]})]})})},kt=()=>{const j=ke(),{getTotalBalance:y,categories:c,transactions:$,accounts:k,deleteTransaction:r,restoreTransaction:x}=V(),[S,h]=o.useState(!1),[_,C]=o.useState(!1),[M,I]=o.useState(null),[A,D]=o.useState(new Date),[v,w]=o.useState(null),m=o.useMemo(()=>{const a=Se(A),d=Ce(A),f=$.filter(g=>!g.isDeleted&&Me(new Date(g.date||g.createdAt),{start:a,end:d})),T=f.filter(g=>g.type==="income").reduce((g,z)=>g+Number(z.amount),0),U=f.filter(g=>g.type==="expense").reduce((g,z)=>g+Number(z.amount),0),L=T-U,F=T>0?Math.round(L/T*100):0;return{transactions:f,income:T,expense:U,savings:L,savingsRate:F}},[A,$]),R=a=>{D(d=>a>0?Re(d,1):qe(d))},b=(a,d)=>{a.stopPropagation(),r(d),w({id:d,message:"Transaction deleted."}),setTimeout(()=>w(null),4e3)},s=()=>{v&&(x(v.id),w(null))},l=a=>{I(a),h(!0)},p=y(),u=[...m.transactions].sort((a,d)=>new Date(d.date||d.createdAt)-new Date(a.date||a.createdAt));return e.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-950 pb-24",children:[e.jsxs("header",{className:"bg-slate-900 text-white p-6 pb-8 rounded-b-[2.5rem] shadow-2xl shadow-slate-900/20 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white/5 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("button",{onClick:()=>j("/"),className:"p-2 bg-white/10 rounded-xl hover:bg-white/20 transition-colors",children:e.jsx(Ae,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex items-center gap-3 bg-white/10 rounded-full px-1 p-1",children:[e.jsx("button",{onClick:()=>R(-1),className:"p-1 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(De,{className:"w-4 h-4 text-slate-300"})}),e.jsx("span",{className:"text-sm font-bold min-w-[80px] text-center",children:q(A,"MMM yyyy")}),e.jsx("button",{onClick:()=>R(1),className:"p-1 hover:bg-white/10 rounded-full transition-colors",children:e.jsx($e,{className:"w-4 h-4 text-slate-300"})})]}),e.jsx("button",{onClick:()=>j("/finance/analytics"),className:"p-2 bg-white/10 rounded-xl hover:bg-white/20 transition-colors",children:e.jsx(re,{className:"w-5 h-5 text-white"})})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("p",{className:"text-slate-400 text-xs font-bold uppercase tracking-widest mb-2",children:"Total Net Balance"}),e.jsxs("h2",{className:"text-4xl font-black bg-gradient-to-r from-white to-slate-400 bg-clip-text text-transparent",children:["â‚¹",p.toLocaleString()]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"bg-white/5 backdrop-blur-sm p-3 rounded-2xl border border-white/5",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-emerald-500/20 flex items-center justify-center mb-2",children:e.jsx(He,{className:"w-4 h-4 text-emerald-400"})}),e.jsx("p",{className:"text-[10px] text-slate-400 uppercase font-bold mb-1",children:"Income"}),e.jsxs("p",{className:"font-bold text-white text-sm",children:["â‚¹",m.income.toLocaleString()]})]}),e.jsxs("div",{className:"bg-white/5 backdrop-blur-sm p-3 rounded-2xl border border-white/5 relative overflow-hidden",children:[m.savingsRate>0&&e.jsxs("div",{className:"absolute top-0 right-0 bg-emerald-500 text-white text-[9px] font-bold px-1.5 py-0.5 rounded-bl-lg",children:[m.savingsRate,"%"]}),e.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-500/20 flex items-center justify-center mb-2",children:e.jsx(tt,{className:"w-4 h-4 text-indigo-400"})}),e.jsx("p",{className:"text-[10px] text-slate-400 uppercase font-bold mb-1",children:"Savings"}),e.jsxs("p",{className:`font-bold text-sm ${m.savings>=0?"text-indigo-300":"text-red-400"}`,children:[m.savings>=0?"+":"","â‚¹",m.savings.toLocaleString()]})]}),e.jsxs("button",{onClick:()=>j("/finance/debts"),className:"bg-white/5 backdrop-blur-sm p-3 rounded-2xl border border-white/5 hover:bg-white/10 transition-colors text-left",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-rose-500/20 flex items-center justify-center mb-2",children:e.jsx(Ie,{className:"w-4 h-4 text-rose-400"})}),e.jsx("p",{className:"text-[10px] text-slate-400 uppercase font-bold mb-1",children:"Debts"}),e.jsx("p",{className:"font-bold text-rose-300 text-xs",children:"Manage â†’"})]})]})]})]}),e.jsxs("div",{className:"px-4 py-6 space-y-8 -mt-4 relative z-10",children:[e.jsx("section",{className:"overflow-x-auto pb-2 -mx-4 px-4 scrollbar-hide",children:e.jsxs("div",{className:"flex gap-3 w-max",children:[e.jsxs("div",{onClick:()=>C(!0),className:"min-w-[140px] bg-indigo-500 p-4 rounded-2xl shadow-lg shadow-indigo-500/20 cursor-pointer hover:scale-[1.02] transition-transform flex flex-col justify-between text-white",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-white/20 flex items-center justify-center mb-2",children:e.jsx(re,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-indigo-200 font-bold uppercase tracking-wider mb-1",children:"Overview"}),e.jsx("p",{className:"text-lg font-bold",children:"Budgets"})]})]}),k.filter(a=>!a.isArchived).map(a=>e.jsxs("div",{onClick:()=>j(`/finance/account/${a.id}`),className:"min-w-[140px] bg-white dark:bg-slate-900 p-4 rounded-2xl shadow-lg shadow-slate-200/50 dark:shadow-none border border-slate-100 dark:border-slate-800 cursor-pointer hover:scale-[1.02] transition-transform",children:[e.jsx("p",{className:"text-xs text-slate-400 font-bold uppercase tracking-wider mb-2",children:a.name}),e.jsxs("p",{className:"text-lg font-bold text-slate-900 dark:text-white",children:["â‚¹",a.balance.toLocaleString()]})]},a.id))]})}),e.jsx("section",{children:e.jsx(ut,{})}),e.jsxs("section",{children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white text-lg",children:"Transactions"}),e.jsx("span",{className:"bg-slate-100 dark:bg-slate-800 text-slate-500 text-xs font-bold px-2 py-1 rounded-full",children:q(A,"MMM")})]})}),e.jsx("div",{className:"space-y-3",children:u.length===0?e.jsxs("div",{className:"text-center py-12 px-6 bg-white dark:bg-slate-900 rounded-3xl border border-slate-100 dark:border-slate-800",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-50 dark:bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-4 text-slate-300",children:e.jsx(Oe,{className:"w-8 h-8"})}),e.jsx("p",{className:"text-slate-900 dark:text-white font-bold text-lg mb-2",children:"No expenses yet"}),e.jsx("p",{className:"text-slate-500 text-sm mb-6 max-w-[240px] mx-auto leading-relaxed",children:"Start tracking where your money goes. Record purchases, bills, or any income."}),e.jsx("button",{onClick:()=>{I(null),h(!0)},className:"bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-xl font-bold transition-transform active:scale-95 shadow-lg shadow-indigo-500/20",children:"+ Add First Record"})]}):u.map(a=>{const d=c.find(f=>f.id===a.categoryId);return e.jsxs("div",{onClick:()=>l(a.id),className:"group relative flex items-center justify-between bg-white dark:bg-slate-900 p-4 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-800 hover:shadow-md transition-all cursor-pointer overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-4 relative z-10",children:[e.jsxs("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-lg ${d?.color?d.color+"/20":"bg-slate-100"} ${d?.color?.replace("bg-","text-")||"text-slate-500"}`,children:[d?.icon==="Utensils"&&"ðŸ½ï¸",d?.icon==="Bus"&&"ðŸšŒ",d?.icon==="ShoppingBag"&&"ðŸ›ï¸",d?.icon==="Zap"&&"âš¡",d?.icon==="IndianRupee"&&"â‚¹",!d?.icon&&(d?.name?.[0]||"?")]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-slate-900 dark:text-white text-sm",children:a.note||d?.name}),e.jsx("p",{className:"text-xs text-slate-400",children:q(new Date(a.date||a.createdAt),"MMM d, h:mm a")})]})]}),e.jsxs("div",{className:"text-right relative z-10",children:[e.jsxs("p",{className:`font-bold ${a.type==="income"?"text-emerald-500":"text-slate-900 dark:text-white"}`,children:[a.type==="income"?"+":"-","â‚¹",Number(a.amount).toLocaleString()]}),e.jsx("p",{className:"text-[10px] text-slate-300 font-medium uppercase tracking-wide opacity-0 group-hover:opacity-100 transition-opacity",children:k.find(f=>f.id===a.accountId)?.name})]}),e.jsx("button",{onClick:f=>b(f,a.id),className:"absolute right-0 top-0 bottom-0 w-16 bg-red-500 text-white flex items-center justify-center translate-x-full group-hover:translate-x-0 transition-transform duration-300 pointer-events-auto hover:bg-red-600 z-50 shadow-[-4px_0_8px_rgba(0,0,0,0.1)]",children:e.jsx(Y,{className:"w-5 h-5"})})]},a.id)})})]})]}),e.jsx("button",{onClick:()=>{I(null),h(!0)},className:"fixed bottom-6 right-6 w-14 h-14 bg-indigo-600 text-white rounded-full shadow-xl shadow-indigo-600/30 flex items-center justify-center hover:scale-105 transition-transform active:scale-95 z-40",children:e.jsx(Ee,{className:"w-6 h-6"})}),S&&e.jsx(mt,{isOpen:!0,onClose:()=>h(!1),editTransactionId:M,onDelete:a=>{r(a),w({id:a,message:"Transaction deleted."}),setTimeout(()=>w(null),4e3)}}),e.jsx(ht,{isOpen:_,onClose:()=>C(!1)}),e.jsx(de,{children:v&&e.jsxs(X.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:50},className:"fixed bottom-24 left-1/2 -translate-x-1/2 z-50 bg-slate-900 text-white px-5 py-3 rounded-full shadow-2xl flex items-center gap-4",children:[e.jsx("span",{className:"text-sm font-medium",children:v.message}),e.jsxs("button",{onClick:s,className:"text-indigo-300 hover:text-white text-sm font-bold flex items-center gap-1",children:[e.jsx(xt,{className:"w-4 h-4"}),"Undo"]})]})})]})};export{kt as default};
