<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forgot Password - Awake</title>
    <link rel="stylesheet" href="css/auth.css">
</head>

<body>
    <div class="auth-container">
        <div class="card">
            <h1>Forgot Password?</h1>
            <p class="subtitle">Enter your details to receive a reset code</p>

            <form id="forgot-form" onsubmit="event.preventDefault(); initiateReset();">
                <div class="form-error"></div>

                <div class="form-group">
                    <label for="identifier">Email, Phone, or Username</label>
                    <input type="text" id="identifier" name="identifier" required>
                </div>

                <button type="submit" class="btn">Send Reset Code</button>

                <div class="links">
                    <p><a href="login.html">Back to Login</a></p>
                </div>
            </form>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/session.js"></script>
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script>
        async function initiateReset() {
            const form = document.getElementById('forgot-form');
            const identifier = document.getElementById('identifier').value.trim();
            const btn = form.querySelector('button');

            try {
                Auth.setLoading(form, true);
                Auth.setError(form, null);

                // Note: You need to implement 'requestPasswordReset' in backend if not already there,
                // or reusing a specific flow. Assuming 'requestPasswordReset' exists or similar.
                // For now, based on previous backend code, we might not have exposed this explicitly
                // in the 'doPost' switch, but the user requested it in the requirements.
                // I will add a method that would call it.
                await API.post('requestPasswordReset', { identifier });

                localStorage.setItem('temp_signup_identifier', identifier);
                window.location.href = 'verify-otp.html?type=reset';

            } catch (e) {
                Auth.setError(form, e.message);
            } finally {
                Auth.setLoading(form, false);
            }
        }
    </script>
</body>

</html>