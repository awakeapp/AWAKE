const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/UnlockDayModal-BolQXqI8.js","assets/index-BWg32Vig.js","assets/index-DsoWCCgr.css","assets/Input-CK5phB3J.js"])))=>i.map(i=>d[i]);
import{k as ie,l as ne,n as oe,r as n,o as de,j as e,p as k,m as ce,S as xe,B as Y,q as me,t as he,v as ue,_ as pe}from"./index-BWg32Vig.js";import{D as fe,R as be,a as ge,b as ke,T as je,U as Ne}from"./DateHeader-D6NkwJkN.js";import{L as ve,P as z,a as $}from"./pen-DqxwgB-a.js";import{T as ye,a as we}from"./trophy-Dj_DrWN3.js";import{F as Se}from"./flame-CwoJVM0t.js";import"./TaskItem-DPk1D_iG.js";import"./bike-v1NKmqis.js";import"./trash-2-BAfFPuwj.js";import"./circle-check-big-BaY48f8q.js";import"./chevron-up-BXANZgQf.js";import"./subMonths-D_Ocl1wU.js";import"./isSameMonth-Dk1qXVNk.js";import"./Card-CAWaWbO5.js";import"./index-nMUoNjSL.js";import"./plus-qPdzeLaY.js";import"./circle-alert-CPZIbIr8.js";import"./smartphone-CuSMevIn.js";import"./star-0VTz1Egw.js";import"./trending-up-CTvzKUSf.js";import"./award-2N10ObK5.js";const Oe=n.lazy(()=>pe(()=>import("./UnlockDayModal-BolQXqI8.js"),__vite__mapDeps([0,1,2,3]))),Je=()=>{const{dailyData:a,updateTaskStatus:W,updateHabit:q,updateAllTasks:Ee,isLocked:m,submitDay:J,unlockDay:K}=ie(),{isPast:j}=ne(),N=oe(),[Q,v]=n.useState(!1),[X,y]=n.useState(!1),[Z,b]=n.useState(!1),[h,R]=n.useState({current:0,longest:0,loading:!0});n.useEffect(()=>{if(!user)return;(async()=>{try{const s=await me.getCollection(`users/${user.uid}/days`,he("date","desc"),ue(365)),l=r=>{if(!r.tasks||r.tasks.length===0)return!1;const o=r.tasks.filter(x=>x.status==="checked").length;return Math.round(o/r.tasks.length*100)===100};let i=0,c=0,p=0;const F=new Date().toISOString().split("T")[0],U=s.find(r=>r.date===F);U&&l(U)&&(i=1);const P=r=>{const o=new Date(r);return o.setDate(o.getDate()-1),o.toISOString().split("T")[0]};let g=P(F);for(;;){const r=s.find(o=>o.date===g||o.id===g);if(r&&l(r))i++,g=P(g);else break}const f=[...s].sort((r,o)=>r.date.localeCompare(o.date));if(f.length>0){let r=new Date(f[0].date);const o=new Date(f[f.length-1].date);let x=0;for(;r<=o;){const _=r.toISOString().split("T")[0],V=f.find(B=>B.date===_||B.id===_);V&&l(V)?x++:(c=Math.max(c,x),x=0),r.setDate(r.getDate()+1)}c=Math.max(c,x)}R({current:i,longest:c,loading:!1})}catch(s){console.error("Streak calc error:",s),R({current:0,longest:0,loading:!1})}})()},[user,a.tasks]);const[w,S]=n.useState({isOpen:!1,type:"success",category:""}),[I,ee]=n.useState(!0),{tasks:H}=de(),L=H.filter(t=>t.status!=="done").slice(0,3),O=new Date().getHours();let E="Good Morning";O>=12&&O<17?E="Good Afternoon":O>=17&&(E="Good Evening");const te=a.tasks.filter(t=>t.status==="checked").length,A=a.tasks.length,d=A>0?Math.round(te/A*100):0,D=H.filter(t=>t.status!=="done").length;let u="";if(d>=80&&(u="Finishing strong."),d===100&&(u="Discipline mastered."),D===0&&d===100&&(u="All systems go."),!a||!a.tasks)return e.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:e.jsx(ve,{className:"w-8 h-8 animate-spin text-primary-500"})});const G={"EARLY MORNING":a.tasks.filter(t=>t.category==="EARLY MORNING"),"BEFORE NOON":a.tasks.filter(t=>t.category==="BEFORE NOON"),"AFTER NOON":a.tasks.filter(t=>t.category==="AFTER NOON"),"EVE/NIGHT":a.tasks.filter(t=>t.category==="EVE/NIGHT"||t.category==="NIGHT")},C=n.useRef({});n.useEffect(()=>{if(!a?.tasks||j)return;const t={};if(Object.entries(G).forEach(([s,l])=>{if(l.length===0){t[s]="empty";return}const i=l.every(p=>p.status==="checked"),c=l.every(p=>p.status==="checked"||p.status==="missed");i?t[s]="success":c?t[s]="failed":t[s]="incomplete"}),I){C.current=t,ee(!1);return}Object.entries(t).forEach(([s,l])=>{const i=C.current[s]||"incomplete";l!==i&&(i==="incomplete"&&l==="success"?S({isOpen:!0,type:"success",category:s}):i==="incomplete"&&l==="failed"&&S({isOpen:!0,type:"troll",category:s}))}),C.current=t},[a.tasks,j,I]);const se=()=>v(!0),ae=async t=>{await J(t),v(!1)},re=t=>{K(t),b(!1)},[T,M]=n.useState("");n.useEffect(()=>{if(T)return;const t=new Date().getHours();let s="";t<8?s="EARLY MORNING":t<12?s="BEFORE NOON":t<17?s="AFTER NOON":s="EVE/NIGHT";const l=a.tasks.some(i=>s==="EVE/NIGHT"?i.category==="EVE/NIGHT"||i.category==="NIGHT":i.category===s);M(l?s:"EARLY MORNING")},[a.tasks,T]);const le=t=>{M(s=>s===t?"":t)};return e.jsxs("div",{className:"pb-32 px-4 pt-4 space-y-6",children:[e.jsx("div",{className:"sticky top-[60px] z-20 bg-white/80 dark:bg-slate-950/80 backdrop-blur-md pt-1 pb-3 -mx-4 px-4 border-b border-transparent",children:e.jsx(fe,{className:"mb-0"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-end justify-between px-1",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-800 dark:text-white tracking-tight",children:[E,", User"]}),u&&e.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-sm font-medium",children:u})]}),e.jsxs("div",{className:"text-right hidden sm:block",children:[e.jsx("div",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest",children:"Workspace"}),e.jsxs("div",{className:"text-lg font-semibold text-slate-700 dark:text-slate-200",children:[D," tasks left"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-3xl p-5 shadow-sm relative overflow-hidden",children:[e.jsx("div",{className:"absolute bottom-0 left-0 h-1 bg-indigo-500/20 transition-all duration-1000",style:{width:`${d}%`}}),e.jsxs("div",{className:"flex items-center justify-between relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:k("w-12 h-12 rounded-2xl flex items-center justify-center transition-colors",d===100?"bg-emerald-100 text-emerald-600 dark:bg-emerald-500/20 dark:text-emerald-400":"bg-slate-100 text-indigo-600 dark:bg-slate-800 dark:text-indigo-400"),children:d===100?e.jsx(ye,{className:"w-6 h-6"}):e.jsx(we,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-0.5",children:"Routine"}),e.jsxs("div",{className:"text-xl font-bold text-slate-900 dark:text-white leading-none",children:[d,"% ",e.jsx("span",{className:"text-sm font-medium text-slate-400 ml-1",children:"Complete"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"sm:hidden text-right mr-2",children:[e.jsx("div",{className:"text-[10px] font-bold text-slate-400 uppercase",children:"Tasks"}),e.jsx("div",{className:"text-sm font-bold text-slate-700 dark:text-slate-300",children:D})]}),e.jsx("button",{onClick:()=>y(!0),className:k("w-10 h-10 rounded-full flex items-center justify-center bg-slate-50 hover:bg-slate-100 dark:bg-slate-800 dark:hover:bg-slate-700 text-slate-500 transition-colors",m&&"hidden"),children:e.jsx(z,{className:"w-4 h-4 stroke-[2]"})})]})]})]}),d===100&&e.jsxs(ce.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-100 dark:border-emerald-900/30 rounded-xl p-3 flex items-center gap-3 text-emerald-700 dark:text-emerald-400",children:[e.jsx(xe,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-semibold",children:"All daily routines completed. Excellent discipline."})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-800 rounded-xl p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:k("p-2 rounded-lg",h.current>0?"bg-orange-100 text-orange-600 dark:bg-orange-900/20 dark:text-orange-500":"bg-slate-200 text-slate-400 dark:bg-slate-800"),children:e.jsx(Se,{className:k("w-5 h-5",h.current>0&&"fill-current")})}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-bold text-slate-700 dark:text-slate-200",children:[h.current," Day Streak"]}),e.jsxs("div",{className:"text-[10px] font-semibold text-slate-400 uppercase tracking-wide",children:["Longest: ",h.longest]})]})]}),e.jsx("div",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 text-right",children:h.current>0?e.jsx("span",{className:"text-orange-600 dark:text-orange-500",children:"Streak continues."}):"Start a new streak today."})]})]}),e.jsx("div",{className:"space-y-2",children:a.tasks.length>0?Object.entries(G).map(([t,s])=>e.jsx(be,{title:t,tasks:s,onUpdateStatus:W,isLocked:m,isOpen:T===t,onToggle:()=>le(t)},t)):m?e.jsxs("button",{onClick:()=>b(!0),className:"w-full py-12 border-2 border-dashed border-slate-200 dark:border-slate-800 rounded-2xl flex flex-col items-center justify-center text-slate-400 hover:text-amber-500 hover:border-amber-200 dark:hover:border-amber-900/50 hover:bg-slate-50 dark:hover:bg-slate-900/50 transition-all group",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-amber-50 dark:bg-amber-900/20 flex items-center justify-center mb-3 group-hover:scale-110 transition-transform",children:e.jsx($,{className:"w-6 h-6 text-amber-500"})}),e.jsx("span",{className:"font-semibold text-sm text-slate-600 dark:text-slate-300",children:"Day Locked"}),e.jsx("span",{className:"text-xs mt-1",children:"Unlock availability to add routines"})]}):e.jsxs("button",{onClick:()=>y(!0),className:"w-full py-12 border-2 border-dashed border-slate-200 dark:border-slate-800 rounded-2xl flex flex-col items-center justify-center text-slate-400 hover:text-indigo-500 hover:border-indigo-200 dark:hover:border-indigo-900/50 hover:bg-slate-50 dark:hover:bg-slate-900/50 transition-all group",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center mb-3 group-hover:scale-110 transition-transform",children:e.jsx(z,{className:"w-6 h-6"})}),e.jsx("span",{className:"font-semibold text-sm",children:"Design Your Day"}),e.jsx("span",{className:"text-xs mt-1",children:"Add your daily rituals & routines"})]})}),e.jsx(ge,{habits:a.habits,onUpdateHabit:q,isLocked:m}),L.length>0&&e.jsxs("div",{className:"pt-4 border-t border-slate-200 dark:border-slate-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 px-1",children:[e.jsx("h3",{className:"text-[11px] font-bold text-slate-400 uppercase tracking-widest",children:"Priority Tasks"}),e.jsx("button",{onClick:()=>N("/workspace"),className:"text-[11px] font-bold text-indigo-500 hover:text-indigo-600",children:"VIEW ALL"})]}),e.jsx("div",{className:"space-y-2",children:L.map(t=>e.jsxs("div",{className:"bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 p-3 rounded-xl flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${t.priority==="High"?"bg-red-500":"bg-slate-300"}`}),e.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:t.name})]}),e.jsx("span",{className:"text-xs text-slate-400",children:t.time||"Today"})]},t.id))})]}),e.jsx("div",{className:"pt-6",children:m?e.jsxs("div",{className:"text-center p-6 bg-slate-50 dark:bg-slate-900/50 rounded-2xl border border-slate-200 dark:border-slate-800/50 dashed",children:[e.jsxs("div",{className:"flex flex-col items-center gap-2 mb-4",children:[e.jsx($,{className:"w-6 h-6 text-slate-400"}),e.jsx("p",{className:"text-sm text-slate-500 font-medium",children:"Day Completed & Locked"})]}),a.locked&&!j&&e.jsx(Y,{variant:"outline",onClick:()=>b(!0),className:"w-full sm:w-auto text-xs h-9",children:"Unlock to Edit"})]}):e.jsx(Y,{className:"w-full py-4 text-base font-semibold shadow-xl shadow-indigo-500/20",onClick:se,children:"Complete Day"})}),e.jsx(ke,{isOpen:Q,onClose:()=>v(!1),data:a,onConfirm:ae}),e.jsx(je,{isOpen:X,onClose:()=>y(!1),tasks:a.tasks}),e.jsx(Ne,{isOpen:w.isOpen,onClose:()=>S(t=>({...t,isOpen:!1})),type:w.type,category:w.category}),e.jsx(n.Suspense,{fallback:null,children:e.jsx(Oe,{isOpen:Z,onClose:()=>b(!1),onConfirm:re})}),e.jsxs("div",{className:"flex justify-center gap-6 opacity-40 pt-8 pb-4",children:[e.jsx("button",{onClick:()=>N("/history"),className:"text-[10px] font-bold uppercase tracking-wider text-slate-500",children:"History"}),e.jsx("div",{className:"w-px h-3 bg-slate-300 my-auto"}),e.jsx("button",{onClick:()=>N("/settings"),className:"text-[10px] font-bold uppercase tracking-wider text-slate-500",children:"Settings"})]})]})};export{Je as default};
