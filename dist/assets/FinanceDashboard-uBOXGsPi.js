import{c as _,w as Z,h as Ne,r as o,ab as q,$ as ne,j as e,A as de,m as Y,X as G,ay as we,x as ye,az as ke,n as Se,g as Ce,p as Me,aj as Ae,ak as De,aA as $e,D as Ie,E as Re,M as re,W as _e,an as Be}from"./index-Dni63RkL.js";import{T as ze}from"./triangle-alert-Bxz0ynlq.js";import{R as Le}from"./refresh-cw-DddJYKiQ.js";import{M as Pe,B as Te,S as Fe,T as Ue}from"./trash-2-MMtH6vPd.js";import{M as Oe}from"./monitor-D4KyN5DK.js";import{S as Ee}from"./smartphone-CBY9Vp78.js";import{C as We}from"./credit-card-BvAAg41A.js";import{d as He}from"./differenceInDays-CvYp_-Z2.js";import{A as qe}from"./arrow-left-BW-eLmrt.js";import{T as Ve}from"./trending-up-CtWGxLuU.js";import{P as Ze}from"./plus-C4dEmhiS.js";import{s as Ke}from"./subMonths-ypCLOBVC.js";const Qe=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],Xe=_("arrow-down",Qe);const Ye=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Ge=_("file-text",Ye);const Je=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],et=_("pause",Je);const tt=[["path",{d:"M11 17h3v2a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-3a3.16 3.16 0 0 0 2-2h1a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1h-1a5 5 0 0 0-2-4V3a4 4 0 0 0-3.2 1.6l-.3.4H11a6 6 0 0 0-6 6v1a5 5 0 0 0 2 4v3a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1z",key:"1piglc"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M2 8v1a2 2 0 0 0 2 2h1",key:"1env43"}]],st=_("piggy-bank",tt);const at=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],lt=_("play",at);const nt=[["path",{d:"M16 3h5v5",key:"1806ms"}],["path",{d:"M8 3H3v5",key:"15dfkv"}],["path",{d:"M12 22v-8.3a4 4 0 0 0-1.172-2.872L3 3",key:"1qrqzj"}],["path",{d:"m15 9 6-6",key:"ko1vev"}]],rt=_("split",nt);const ot=[["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],it=_("trash",ot);const dt=[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]],ct=_("undo",dt),xt=({isOpen:u,onClose:g,editTransactionId:c=null,onDelete:A})=>{const{addTransaction:M,addTransfer:r,editTransaction:x,deleteTransaction:k,checkDuplicate:j,categories:B,accounts:v,transactions:C,addRecurringRule:D,getBudgetStats:P}=Z(),{user:N}=Ne(),[w,z]=o.useState(""),[p,S]=o.useState("expense"),[m,s]=o.useState(""),[a,f]=o.useState(""),[h,$]=o.useState(""),[U,n]=o.useState(""),[d,y]=o.useState(q(new Date,"yyyy-MM-dd")),[I,T]=o.useState(null),[O,E]=o.useState(null),[b,F]=o.useState(!1),[J,ce]=o.useState("monthly"),[ee,xe]=o.useState(""),[L,te]=o.useState(!1),[R,K]=o.useState([{categoryId:"",amount:""}]),[Q,X]=o.useState(null);o.useEffect(()=>{!c&&N&&ne.getDocument(`users/${N.uid}/config`,"ui").then(t=>{t&&t.lastUsedAccountId&&v.some(l=>l.id===t.lastUsedAccountId)&&f(t.lastUsedAccountId)})},[v,c,N]),o.useEffect(()=>{if(c){const t=C.find(l=>l.id===c);t&&(z(t.amount),S(t.type),f(t.type==="transfer"?t.fromAccountId:t.accountId),t.type==="transfer"?$(t.toAccountId):s(t.categoryId),n(t.note),t.date&&y(q(new Date(t.date),"yyyy-MM-dd")),t.receipt&&(T(t.receipt),E(t.receipt)))}},[c,C]);const me=t=>{const l=t.target.files[0];if(!l)return;if(l.size>100*1024){alert("File too large (max 100KB for now)");return}const i=new FileReader;i.onloadend=()=>{T(i.result),E(i.result)},i.readAsDataURL(l)},ue=()=>K([...R,{categoryId:"",amount:""}]),he=t=>{const l=[...R];l.splice(t,1),K(l)},se=(t,l,i)=>{const H=[...R];H[t][l]=i,K(H)},be=R.reduce((t,l)=>t+(Number(l.amount)||0),0),ae=Number(w)-be,pe=t=>z(t.toString()),le=t=>{t.preventDefault();const l=Number(w);if(!w||isNaN(l))return;if(!c&&!Q){const H=j({amount:l,type:p,categoryId:m,toAccountId:h});if(H){X(H);return}}const i={amount:l,type:p,note:U,date:new Date(d).toISOString(),receipt:I};if(p==="transfer"){if(!a||!h||a===h)return;c?x(c,{...i,fromAccountId:a,toAccountId:h}):r({...i,fromAccountId:a,toAccountId:h})}else{if(!m||!a)return;c?x(c,{...i,categoryId:m,accountId:a}):b?D({frequency:J,startDate:i.date,endDate:ee||null,transactionTemplate:{...i,categoryId:L?null:m,accountId:a,splits:L?R:null}}):M({...i,categoryId:L?"cat_split":m,accountId:a,splits:L?R:null,mode:"manual"}),N&&ne.setItem(`users/${N.uid}/config`,"ui",{lastUsedAccountId:a},!0)}g()},V=v.filter(t=>!t.isArchived),ge=B.filter(t=>t.type==="expense"),fe=B.filter(t=>t.type==="income"),W=p==="expense"?ge:fe,je=o.useMemo(()=>{if(!C.length)return W.slice(0,4);const t={};return C.forEach(l=>{l.categoryId&&(t[l.categoryId]=(t[l.categoryId]||0)+1)}),W.map(l=>({...l,count:t[l.id]||0})).sort((l,i)=>i.count-l.count).slice(0,4)},[C,W]),ve=[100,500,1e3,2e3];return e.jsx(de,{children:u&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center pointer-events-none",children:[e.jsx(Y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:g,className:"absolute inset-0 bg-black/60 backdrop-blur-sm pointer-events-auto"}),e.jsxs(Y.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},className:"bg-white dark:bg-slate-900 w-full max-w-md rounded-t-[2rem] p-6 shadow-md pointer-events-auto relative max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:c?"Edit Transaction":"Add Transaction"}),e.jsx("button",{onClick:g,className:"p-2 bg-slate-100 dark:bg-slate-800 rounded-full",children:e.jsx(G,{className:"w-5 h-5"})})]}),Q&&e.jsxs("div",{className:"mb-6 p-4 bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded flex gap-3 items-start animate-in fade-in slide-in-from-top-2",children:[e.jsx(ze,{className:"w-5 h-5 text-orange-500 shrink-0 mt-px"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-orange-800 dark:text-orange-200 text-sm",children:"Potential Duplicate"}),e.jsxs("p",{className:"text-xs text-orange-600 dark:text-orange-300 mt-1",children:["We found a similar transaction of â‚¹",Q.amount," created recently."]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx("button",{onClick:()=>X(null),className:"px-3 py-2 bg-white dark:bg-slate-800 text-xs font-bold rounded shadow-sm",children:"Cancel"}),e.jsx("button",{onClick:t=>{X(null),le(t)},className:"px-3 py-2 bg-orange-500 text-white text-xs font-bold rounded shadow-sm",children:"Save Anyway"})]})]})]}),e.jsx("div",{className:"flex bg-slate-100 dark:bg-slate-800 p-1 rounded mb-6",children:["expense","income","transfer"].map(t=>e.jsx("button",{onClick:()=>{S(t),te(!1),F(!1)},className:`flex-1 py-2 text-sm font-bold capitalize rounded-lg transition-all ${p===t?"bg-white dark:bg-slate-700 shadow-sm text-slate-900 dark:text-white":"text-slate-500"}`,children:t},t))}),p==="expense"&&!c&&e.jsxs("div",{className:"flex gap-4 mb-4",children:[e.jsxs("button",{type:"button",onClick:()=>F(!b),className:`flex-1 flex items-center justify-center gap-2 py-2 rounded-xl text-xs font-bold border transition-colors ${b?"bg-indigo-50 border-indigo-500 text-indigo-600":"bg-white border-slate-200 text-slate-500"}`,children:[e.jsx(we,{className:"w-3.5 h-3.5"}),"Recurring Rule"]}),e.jsxs("button",{type:"button",onClick:()=>te(!L),className:`flex-1 flex items-center justify-center gap-2 py-2 rounded-xl text-xs font-bold border transition-colors ${L?"bg-indigo-50 border-indigo-500 text-indigo-600":"bg-white border-slate-200 text-slate-500"}`,children:[e.jsx(rt,{className:"w-3.5 h-3.5"}),"Split Bill"]})]}),e.jsxs("form",{onSubmit:le,className:"space-y-5",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 block",children:"Amount"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-xl font-bold text-slate-400",children:"â‚¹"}),e.jsx("input",{type:"number",value:w,onChange:t=>z(t.target.value),className:"w-full bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded py-3 pl-8 pr-4 text-xl font-bold text-slate-900 dark:text-white focus:ring-2 focus:ring-indigo-500 focus:outline-none",placeholder:"0",autoFocus:!c})]})]}),e.jsxs("div",{className:"w-1/3",children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 block",children:"Date"}),e.jsx("div",{className:"relative",children:e.jsx("input",{type:"date",value:d,onChange:t=>y(t.target.value),className:"w-full bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded py-3 px-3 text-sm font-bold text-slate-900 dark:text-white focus:ring-2 focus:ring-indigo-500 outline-none"})})]})]}),b&&e.jsx("div",{className:"bg-indigo-50 dark:bg-indigo-900/20 p-4 rounded space-y-3 animate-in fade-in slide-in-from-top-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-bold text-indigo-400 uppercase tracking-wider mb-2 block",children:"Frequency"}),e.jsxs("select",{value:J,onChange:t=>ce(t.target.value),className:"w-full bg-white dark:bg-slate-800 border border-indigo-200 dark:border-indigo-800 rounded p-2 text-sm font-medium focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"yearly",children:"Yearly"})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-bold text-indigo-400 uppercase tracking-wider mb-2 block",children:"End Date (Optional)"}),e.jsx("input",{type:"date",value:ee,onChange:t=>xe(t.target.value),className:"w-full bg-white dark:bg-slate-800 border border-indigo-200 dark:border-indigo-800 rounded p-2 text-sm font-medium focus:ring-2 focus:ring-indigo-500"})]})]})}),e.jsx("div",{className:"flex gap-2 overflow-x-auto scrollbar-hide pb-1",children:ve.map(t=>e.jsxs("button",{type:"button",onClick:()=>pe(t),className:"px-3 py-2 bg-slate-100 dark:bg-slate-800 rounded-full text-xs font-bold text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors whitespace-nowrap",children:["+ â‚¹",t]},t))}),p==="transfer"?e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 block",children:"From"}),e.jsxs("select",{value:a,onChange:t=>f(t.target.value),className:"w-full bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded p-3 text-sm font-medium focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"Select..."}),V.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 block",children:"To"}),e.jsxs("select",{value:h,onChange:t=>$(t.target.value),className:"w-full bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded p-3 text-sm font-medium focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"Select..."}),V.filter(t=>t.id!==a).map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})]}):L?e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider block",children:"Split Categories"}),R.map((t,l)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:t.categoryId,onChange:i=>se(l,"categoryId",i.target.value),className:"flex-1 bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded p-2 text-sm",children:[e.jsx("option",{value:"",children:"Category..."}),W.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]}),e.jsx("input",{type:"number",value:t.amount,onChange:i=>se(l,"amount",i.target.value),placeholder:"0",className:"w-20 bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded p-2 text-sm"}),R.length>1&&e.jsx("button",{type:"button",onClick:()=>he(l),className:"p-2 text-red-500 hover:bg-red-50 rounded",children:e.jsx(it,{className:"w-4 h-4"})})]},l)),e.jsxs("div",{className:"flex justify-between items-center text-xs font-bold",children:[e.jsx("button",{type:"button",onClick:ue,className:"text-indigo-500 hover:underline",children:"+ Add Split"}),e.jsxs("span",{className:ae===0?"text-emerald-500":"text-orange-500",children:["Remaining: ",ae]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 block",children:"Account"}),e.jsxs("select",{value:a,onChange:t=>f(t.target.value),className:"w-full bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded p-3 text-sm font-medium focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"Select Account..."}),V.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 block",children:"Category"}),e.jsx("div",{className:"flex gap-2 flex-wrap mb-2",children:je.map(t=>e.jsx("button",{type:"button",onClick:()=>s(t.id),className:`px-2 py-1 rounded-lg text-[10px] font-bold border transition-colors ${m===t.id?"bg-indigo-50 border-indigo-500 text-indigo-600":"bg-white border-slate-200 text-slate-500"}`,children:t.name},t.id))}),e.jsxs("select",{value:m,onChange:t=>s(t.target.value),className:"w-full bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded p-3 text-sm font-medium focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"Select Category..."}),W.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),m&&P(m)&&e.jsx("div",{className:"mt-2 text-xs",children:(()=>{const t=P(m),l=t.status==="danger",i=t.status==="warning";return e.jsxs("div",{className:`p-2 rounded-lg border ${l?"bg-red-50 border-red-200":i?"bg-orange-50 border-orange-200":"bg-slate-50 border-slate-200"}`,children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:`font-bold ${l?"text-red-700":i?"text-orange-700":"text-slate-600"}`,children:l?"Budget Exceeded":i?"Budget Alert":"Monthly Budget"}),e.jsxs("span",{className:"text-slate-500",children:[t.percent,"% used"]})]}),e.jsx("div",{className:"h-1.5 w-full bg-black/5 rounded-full overflow-hidden mb-1",children:e.jsx("div",{className:`h-full rounded-full transition-all ${l?"bg-red-500":i?"bg-orange-500":"bg-emerald-500"}`,style:{width:`${t.percent}%`}})}),e.jsxs("p",{className:"text-slate-500",children:[e.jsx("span",{className:"font-bold text-slate-700",children:Math.abs(t.remaining)})," ",t.remaining>=0?"remaining":"over spent"," of ",t.budget]})]})})()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 block",children:"Account"}),e.jsxs("select",{value:a,onChange:t=>f(t.target.value),className:"w-full bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded p-3 text-sm font-medium focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"Select Account..."}),V.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 block",children:"Note"}),e.jsx("input",{type:"text",value:U,onChange:t=>n(t.target.value),placeholder:"Description...",className:"w-full bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded p-3 text-sm font-medium focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 block",children:"Receipt"}),e.jsxs("label",{className:"flex items-center justify-center w-11 h-11 bg-slate-100 dark:bg-slate-800 rounded cursor-pointer hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors relative overflow-hidden",children:[O?e.jsx("img",{src:O,alt:"Receipt",className:"w-full h-full object-cover opacity-80"}):e.jsx(Ge,{className:"w-5 h-5 text-slate-500"}),e.jsx("input",{type:"file",className:"hidden",onChange:me,accept:"image/*"}),I&&e.jsx("div",{className:"absolute top-0 right-0 w-3 h-3 bg-indigo-500 border-2 border-white rounded-full"})]}),I&&e.jsx("button",{type:"button",onClick:()=>{T(null),E(null)},className:"ml-2 text-[10px] text-red-500 underline",children:"Remove"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[c&&e.jsx("button",{type:"button",onClick:()=>{window.confirm("Delete this transaction?")&&(A?A(c):k(c),g())},className:"flex-none py-4 px-4 bg-red-50 dark:bg-red-900/20 text-red-500 dark:text-red-400 font-bold rounded hover:bg-red-100 dark:hover:bg-red-900/40 transition-colors",children:"Delete"}),e.jsxs("button",{type:"submit",className:"flex-1 bg-slate-900 dark:bg-emerald-500 dark:text-slate-900 text-white font-bold py-4 rounded shadow-md flex items-center justify-center gap-2 hover:scale-[1.02] active:scale-[0.98] transition-all",children:[c?"Update Transaction":p==="transfer"?"Transfer Funds":"Save Transaction",e.jsx(ye,{className:"w-5 h-5"})]})]})]})]})]})})},oe=[{icon:ke,label:"Utility"},{icon:Pe,label:"Spotify"},{icon:Oe,label:"Netflix"},{icon:Ee,label:"Phone"},{icon:Te,label:"Work"},{icon:Fe,label:"Shop"},{icon:We,label:"Card"}],ie=["from-indigo-500 to-purple-600","from-blue-500 to-cyan-500","from-emerald-500 to-teal-500","from-orange-500 to-red-500","from-pink-500 to-rose-500","from-slate-700 to-slate-900"],mt=()=>{const{subscriptions:u,addSubscription:g,deleteSubscription:c,toggleSubscriptionStatus:A}=Z(),[M,r]=o.useState(!1),[x,k]=o.useState(""),[j,B]=o.useState(""),[v,C]=o.useState(""),[D,P]=o.useState(0),[N,w]=o.useState(0),z=s=>{if(s.preventDefault(),!x||!j||!v)return;const a=Number(v);if(a<1||a>31){alert("Please enter a valid day (1-31)");return}console.log("Saving subscription:",{name:x,amount:j,dayNum:a});try{g({name:x,amount:j,dueDate:a,iconIdx:D,colorIdx:N}),r(!1),k(""),B(""),C("")}catch(f){console.error("Failed to save subscription:",f),alert("Failed to save. Please try again.")}},p=s=>{const a=new Date,f=new Date(s),h=He(f,a);return h<0?`Overdue ${Math.abs(h)}d`:h===0?"Due Today":h===1?"Tomorrow":`${h} days left`},S=[...u].sort((s,a)=>s.nextBillingDate?new Date(s.nextBillingDate)-new Date(a.nextBillingDate):0),m=u.filter(s=>s.status==="active").reduce((s,a)=>s+Number(a.amount),0);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-2",children:[e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white",children:"Upcoming Payments"}),e.jsx("button",{onClick:()=>r(!0),className:"text-xs text-indigo-500 font-bold uppercase hover:bg-indigo-50 px-2 py-1 rounded transition-colors",children:"+ Add New"})]}),e.jsx("div",{className:"bg-slate-100 dark:bg-slate-800/50 p-4 rounded flex items-center justify-between mx-2 mb-2",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-200 dark:bg-slate-700 flex items-center justify-center",children:e.jsx(Le,{className:"w-5 h-5 text-slate-500 dark:text-slate-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-400 uppercase font-bold tracking-wider",children:"Monthly Recurring"}),e.jsxs("p",{className:"text-lg font-bold text-slate-900 dark:text-white",children:["â‚¹",m.toLocaleString()]})]})]})}),e.jsxs("div",{className:"overflow-x-auto pb-4 -mx-4 px-4 scrollbar-hide flex gap-3",children:[S.length===0&&!M&&e.jsxs("div",{className:"w-full text-center py-6 border-2 border-dashed border-slate-200 dark:border-slate-800 rounded",children:[e.jsx("p",{className:"text-slate-400 text-sm mb-2",children:"No upcoming bills."}),e.jsx("button",{onClick:()=>r(!0),className:"text-indigo-500 font-bold text-sm",children:"+ Add Bill"})]}),S.map(s=>{const a=oe[s.iconIdx||0].icon,f=ie[s.colorIdx||0],h=p(s.dueDate);return e.jsxs("div",{className:`min-w-[170px] p-4 rounded-[1.5rem] bg-gradient-to-br ${f} text-white shadow-md relative group`,children:[e.jsxs("div",{className:"absolute top-3 right-3 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:$=>{$.stopPropagation(),A(s.id)},className:"p-2 bg-white/20 rounded-full hover:bg-white/40 transition-colors",title:s.status==="active"?"Pause":"Resume",children:s.status==="active"?e.jsx(et,{className:"w-3 h-3 text-white"}):e.jsx(lt,{className:"w-3 h-3 text-white"})}),e.jsx("button",{onClick:$=>{$.stopPropagation(),c(s.id)},className:"p-2 bg-white/20 rounded-full hover:bg-white/40 transition-colors",title:"Delete",children:e.jsx(Ue,{className:"w-3 h-3 text-white"})})]}),e.jsx("div",{className:"bg-white/20 w-10 h-10 rounded-full flex items-center justify-center mb-4 backdrop-blur-sm",children:e.jsx(a,{className:"w-5 h-5 text-white"})}),e.jsx("h4",{className:"font-bold text-lg leading-tight mb-1 truncate",children:s.name}),e.jsxs("p",{className:"text-white/80 text-xs font-medium mb-3",children:["â‚¹",Number(s.amount).toLocaleString(),"/mo"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:`bg-black/20 rounded-lg px-2 py-1 inline-block ${s.status!=="active"?"opacity-50":""}`,children:e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-wide text-white/90",children:s.status==="active"?h:"Paused"})}),s.status!=="active"&&e.jsx("span",{className:"text-[10px] font-bold bg-white/20 px-2 py-1 rounded",children:"Paused"})]})]},s.id)})]}),M&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:()=>r(!1)}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-6 rounded w-full max-w-sm relative z-10 shadow-md animate-in zoom-in-95 duration-200",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Add Subscription"}),e.jsxs("form",{onSubmit:z,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-1 block",children:"Name"}),e.jsx("input",{type:"text",value:x,onChange:s=>k(s.target.value),placeholder:"Netflix",className:"w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded p-3 font-bold",autoFocus:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-1 block",children:"Amount"}),e.jsx("input",{type:"number",value:j,onChange:s=>B(s.target.value),placeholder:"500",className:"w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded p-3 font-bold"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-1 block",children:"Due Day (1-31)"}),e.jsx("input",{type:"number",value:v,onChange:s=>C(s.target.value),placeholder:"15",min:"1",max:"31",className:"w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded p-3 font-bold"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 block",children:"Icon"}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:oe.map((s,a)=>e.jsx("button",{type:"button",onClick:()=>P(a),className:`p-2 rounded-xl border-2 transition-all ${D===a?"border-indigo-500 bg-indigo-50 dark:bg-indigo-900/20":"border-slate-100 dark:border-slate-800"}`,children:e.jsx(s.icon,{className:`w-5 h-5 ${D===a?"text-indigo-600":"text-slate-400"}`})},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 block",children:"Color"}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:ie.map((s,a)=>e.jsx("button",{type:"button",onClick:()=>w(a),className:`w-8 h-8 rounded-full bg-gradient-to-br ${s} ring-2 ring-offset-2 ring-offset-white dark:ring-offset-slate-900 transition-all ${N===a?"ring-indigo-500 scale-110":"ring-transparent opacity-70"}`},a))})]}),e.jsx("button",{type:"submit",className:"w-full bg-slate-900 text-white font-bold py-3 rounded mt-4",children:"Save Subscription"})]})]})]})]})},ut=({isOpen:u,onClose:g})=>{const{categories:c,getBudgetStats:A}=Z();if(!u)return null;const M=c.filter(r=>r.type==="expense"&&Number(r.budget)>0).map(r=>({...r,stats:A(r.id)})).sort((r,x)=>x.stats.percent-r.stats.percent);return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 w-full max-w-sm rounded-[2rem] p-6 shadow-md relative max-h-[80vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 shrink-0",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Monthly Budgets"}),e.jsx("button",{onClick:g,className:"p-2 bg-slate-100 dark:bg-slate-800 rounded-full",children:e.jsx(G,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"overflow-y-auto space-y-4 pr-2 -mr-2",children:[M.map(r=>{const{stats:x}=r,k=x.percent>=100,j=x.percent>=80&&x.percent<100;return e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800/50 p-4 rounded border border-slate-100 dark:border-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm ${r.color?r.color+"/20":"bg-slate-200"} ${r.color?.replace("bg-","text-")||"text-slate-500"}`,children:[r.icon==="Utensils"&&"ðŸ½ï¸",r.icon==="Bus"&&"ðŸšŒ",r.icon==="ShoppingBag"&&"ðŸ›ï¸",r.icon==="Zap"&&"âš¡",!r.icon&&r.name[0]]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-bold text-slate-900 dark:text-white text-sm",children:r.name}),e.jsxs("p",{className:"text-[10px] text-slate-400",children:["Budget: â‚¹",x.budget.toLocaleString()]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:`font-bold text-sm ${k?"text-red-500":j?"text-orange-500":"text-emerald-500"}`,children:[x.percent,"%"]})})]}),e.jsx("div",{className:"h-2 w-full bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden mb-1 relative",children:e.jsx("div",{className:`h-full rounded-full transition-all ${k?"bg-red-500":j?"bg-orange-500":"bg-emerald-500"}`,style:{width:`${x.percent}%`}})}),e.jsxs("div",{className:"flex justify-between text-[10px] font-bold text-slate-400",children:[e.jsxs("span",{children:["Spent: â‚¹",x.spent.toLocaleString()]}),e.jsx("span",{className:k?"text-red-500":j?"text-orange-500":"text-emerald-500",children:x.remaining>=0?`Left: â‚¹${x.remaining.toLocaleString()}`:`Over: â‚¹${Math.abs(x.remaining).toLocaleString()}`})]})]},r.id)}),M.length===0&&e.jsx("div",{className:"text-center py-8 text-slate-400",children:"No active budgets found."})]})]})})},Ct=()=>{const{t:u}=Se(),g=Ce(),{timeFormat:c}=Me(),{getTotalBalance:A,categories:M,transactions:r,accounts:x,deleteTransaction:k,restoreTransaction:j}=Z(),[B,v]=o.useState(!1),[C,D]=o.useState(!1),[P,N]=o.useState(null),[w,z]=o.useState(new Date),[p,S]=o.useState(null),m=o.useMemo(()=>{const n=Ae(w),d=De(w),y=r.filter(b=>!b.isDeleted&&$e(new Date(b.date||b.createdAt),{start:n,end:d})),I=y.filter(b=>b.type==="income").reduce((b,F)=>b+Number(F.amount),0),T=y.filter(b=>b.type==="expense").reduce((b,F)=>b+Number(F.amount),0),O=I-T,E=I>0?Math.round(O/I*100):0;return{transactions:y,income:I,expense:T,savings:O,savingsRate:E}},[w,r]),s=n=>{z(d=>n>0?Be(d,1):Ke(d))},a=(n,d)=>{n.stopPropagation(),k(d),S({id:d,message:u("finance.undo")+"..."}),setTimeout(()=>S(null),4e3)},f=()=>{p&&(j(p.id),S(null))},h=n=>{N(n),v(!0)},$=A(),U=[...m.transactions].sort((n,d)=>new Date(d.date||d.createdAt)-new Date(n.date||n.createdAt));return e.jsxs("div",{className:"min-h-screen pb-24",children:[e.jsxs("header",{className:"bg-slate-900 dark:bg-slate-950 text-white px-6 pt-[calc(env(safe-area-inset-top)+1.5rem)] pb-8 rounded-b-[2.5rem] shadow-md shadow-slate-900/10 relative overflow-hidden shrink-0",children:[e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white/5 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("button",{onClick:()=>g("/"),className:"p-2 bg-white/10 rounded hover:bg-white/20 transition-colors",children:e.jsx(qe,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex items-center gap-3 bg-white/10 rounded-full px-1 p-1",children:[e.jsx("button",{onClick:()=>s(-1),className:"p-1 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(Ie,{className:"w-4 h-4 text-slate-300"})}),e.jsx("span",{className:"text-sm font-bold min-w-[80px] text-center",children:q(w,"MMM yyyy")}),e.jsx("button",{onClick:()=>s(1),className:"p-1 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(Re,{className:"w-4 h-4 text-slate-300"})})]}),e.jsx("button",{onClick:()=>g("/finance/analytics"),className:"p-2 bg-white/10 rounded hover:bg-white/20 transition-colors",children:e.jsx(re,{className:"w-5 h-5 text-white"})})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("p",{className:"text-slate-400 text-xs font-bold uppercase tracking-widest mb-2",children:u("finance.total_net_balance")}),e.jsxs("h2",{className:"text-4xl font-black bg-gradient-to-r from-white to-slate-400 bg-clip-text text-transparent",children:["â‚¹",$.toLocaleString()]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"bg-white/5 backdrop-blur-sm p-3 rounded border border-white/5",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-emerald-500/20 flex items-center justify-center mb-2",children:e.jsx(Xe,{className:"w-4 h-4 text-emerald-400"})}),e.jsx("p",{className:"text-[10px] text-slate-400 uppercase font-bold mb-1",children:u("finance.income")}),e.jsxs("p",{className:"font-bold text-white text-sm",children:["â‚¹",m.income.toLocaleString()]})]}),e.jsxs("div",{className:`bg-white/5 backdrop-blur-sm p-3 rounded-2xl border ${m.savingsRate<0?"border-red-900/50 bg-red-950/20":"border-emerald-900/50 bg-emerald-950/10"} relative overflow-hidden`,children:[m.savingsRate>0&&e.jsxs("div",{className:"absolute top-0 right-0 bg-emerald-500 text-white text-[9px] font-bold px-2 py-px rounded-bl-lg",children:[m.savingsRate,"%"]}),e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center mb-2 ${m.savingsRate<0?"bg-red-500/20":"bg-emerald-500/20"}`,children:e.jsx(st,{className:`w-4 h-4 ${m.savingsRate<0?"text-red-400":"text-emerald-400"}`})}),e.jsx("p",{className:"text-[10px] text-slate-400 uppercase font-bold mb-1",children:u("finance.savings")}),e.jsxs("p",{className:`font-bold text-sm ${m.savingsRate>=0?"text-emerald-300":"text-red-400"}`,children:[m.savings>=0?"+":"","â‚¹",m.savings.toLocaleString()]})]}),e.jsxs("button",{onClick:()=>g("/finance/debts"),className:"bg-white/5 backdrop-blur-sm p-3 rounded border border-white/5 hover:bg-white/10 transition-colors text-left",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-rose-500/20 flex items-center justify-center mb-2",children:e.jsx(_e,{className:"w-4 h-4 text-rose-400"})}),e.jsx("p",{className:"text-[10px] text-slate-400 uppercase font-bold mb-1",children:u("finance.debts")}),e.jsx("p",{className:"font-bold text-rose-300 text-xs",children:u("finance.manage")})]})]})]})]}),e.jsxs("div",{className:"px-4 py-6 space-y-8 -mt-4 relative z-10",children:[e.jsx("section",{className:"overflow-x-auto pb-2 -mx-4 px-4 scrollbar-hide",children:e.jsxs("div",{className:"flex gap-3 w-max",children:[e.jsxs("div",{onClick:()=>D(!0),className:"min-w-[140px] bg-indigo-500 p-4 rounded shadow-md shadow-indigo-500/20 cursor-pointer hover:scale-[1.02] transition-transform flex flex-col justify-between text-white",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-white/20 flex items-center justify-center mb-2",children:e.jsx(re,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-indigo-200 font-bold uppercase tracking-wider mb-1",children:u("finance.overview")}),e.jsx("p",{className:"text-lg font-bold",children:u("finance.budgets")})]})]}),x.filter(n=>!n.isArchived).map(n=>e.jsxs("div",{onClick:()=>g(`/finance/account/${n.id}`),className:"min-w-[140px] bg-white dark:bg-slate-900 p-4 rounded shadow-md shadow-slate-200/50 dark:shadow-none border border-slate-100 dark:border-slate-800 cursor-pointer hover:scale-[1.02] transition-transform",children:[e.jsx("p",{className:"text-xs text-slate-400 font-bold uppercase tracking-wider mb-2",children:n.name}),e.jsxs("p",{className:"text-lg font-bold text-slate-900 dark:text-white",children:["â‚¹",n.balance.toLocaleString()]})]},n.id))]})}),e.jsx("section",{children:e.jsx(mt,{})}),e.jsxs("section",{children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white text-lg",children:u("finance.transactions")}),e.jsx("span",{className:"bg-slate-100 dark:bg-slate-800 text-slate-500 text-xs font-bold px-2 py-1 rounded-full",children:q(w,"MMM")})]})}),e.jsx("div",{className:"space-y-3",children:U.length===0?e.jsxs("div",{className:"text-center py-12 px-6 bg-white dark:bg-slate-900 rounded border border-slate-100 dark:border-slate-800",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-50 dark:bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-4 text-slate-300",children:e.jsx(Ve,{className:"w-8 h-8"})}),e.jsx("p",{className:"text-slate-900 dark:text-white font-bold text-lg mb-2",children:u("finance.no_expenses")}),e.jsx("p",{className:"text-slate-500 text-sm mb-6 max-w-[240px] mx-auto leading-relaxed",children:u("finance.start_tracking")}),e.jsx("button",{onClick:()=>{N(null),v(!0)},className:"bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded font-bold transition-transform active:scale-95 shadow-md shadow-indigo-500/20",children:u("finance.add_first_record")})]}):U.map(n=>{const d=M.find(y=>y.id===n.categoryId);return e.jsxs("div",{onClick:()=>h(n.id),className:"group relative flex items-center justify-between bg-white dark:bg-slate-900 p-4 rounded shadow-sm border border-slate-100 dark:border-slate-800 hover:shadow-md transition-all cursor-pointer overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-4 relative z-10",children:[e.jsxs("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-lg ${d?.color?d.color+"/20":"bg-slate-100"} ${d?.color?.replace("bg-","text-")||"text-slate-500"}`,children:[d?.icon==="Utensils"&&"ðŸ½ï¸",d?.icon==="Bus"&&"ðŸšŒ",d?.icon==="ShoppingBag"&&"ðŸ›ï¸",d?.icon==="Zap"&&"âš¡",d?.icon==="IndianRupee"&&"â‚¹",!d?.icon&&(d?.name?.[0]||"?")]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-slate-900 dark:text-white text-sm",children:n.note||d?.name}),e.jsx("p",{className:"text-xs text-slate-400",children:q(new Date(n.date||n.createdAt),c==="24h"?"MMM d, HH:mm":"MMM d, h:mm a")})]})]}),e.jsxs("div",{className:"text-right relative z-10",children:[e.jsxs("p",{className:`font-bold ${n.type==="income"?"text-emerald-500":"text-slate-900 dark:text-white"}`,children:[n.type==="income"?"+":"-","â‚¹",Number(n.amount).toLocaleString()]}),e.jsx("p",{className:"text-[10px] text-slate-300 font-medium uppercase tracking-wide opacity-0 group-hover:opacity-100 transition-opacity",children:x.find(y=>y.id===n.accountId)?.name})]}),e.jsx("button",{onClick:y=>a(y,n.id),className:"absolute right-0 top-0 bottom-0 w-16 bg-red-500 text-white flex items-center justify-center translate-x-full group-hover:translate-x-0 transition-transform duration-300 pointer-events-auto hover:bg-red-600 z-50 shadow-[-4px_0_8px_rgba(0,0,0,0.1)]",children:e.jsx(G,{className:"w-5 h-5"})})]},n.id)})})]})]}),e.jsx("button",{onClick:()=>{N(null),v(!0)},className:"fixed bottom-6 right-6 w-14 h-14 bg-indigo-600 text-white rounded-full shadow-md shadow-indigo-600/30 flex items-center justify-center hover:scale-105 transition-transform active:scale-95 z-40",children:e.jsx(Ze,{className:"w-6 h-6"})}),B&&e.jsx(xt,{isOpen:!0,onClose:()=>v(!1),editTransactionId:P,onDelete:n=>{k(n),S({id:n,message:u("finance.undo")}),setTimeout(()=>S(null),4e3)}}),e.jsx(ut,{isOpen:C,onClose:()=>D(!1)}),e.jsx(de,{children:p&&e.jsxs(Y.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:50},className:"fixed bottom-24 left-1/2 -translate-x-1/2 z-50 bg-slate-900 text-white px-4 py-3 rounded-full shadow-md flex items-center gap-4",children:[e.jsx("span",{className:"text-sm font-medium",children:p.message}),e.jsxs("button",{onClick:f,className:"text-indigo-300 hover:text-white text-sm font-bold flex items-center gap-1",children:[e.jsx(ct,{className:"w-4 h-4"}),u("finance.undo")]})]})})]})};export{Ct as default};
